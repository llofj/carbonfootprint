{"ast":null,"code":"import { createElementVNode as _createElementVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createCommentVNode as _createCommentVNode, normalizeClass as _normalizeClass, vModelText as _vModelText, withDirectives as _withDirectives, createTextVNode as _createTextVNode } from \"vue\";\nvar _hoisted_1 = {\n  \"class\": \"carbon-calculator\"\n};\nvar _hoisted_2 = {\n  \"class\": \"calculator-container\"\n};\nvar _hoisted_3 = {\n  \"class\": \"left-panel\"\n};\nvar _hoisted_4 = {\n  \"class\": \"category-title\"\n};\nvar _hoisted_5 = {\n  \"class\": \"subcategory-grid\"\n};\nvar _hoisted_6 = [\"onClick\"];\nvar _hoisted_7 = {\n  \"class\": \"subcategory-icon\"\n};\nvar _hoisted_8 = {\n  \"class\": \"subcategory-name\"\n};\nvar _hoisted_9 = {\n  \"class\": \"right-panel\"\n};\nvar _hoisted_10 = {\n  \"class\": \"emission-category\"\n};\nvar _hoisted_11 = {\n  \"class\": \"emission-details\"\n};\nvar _hoisted_12 = {\n  \"class\": \"emission-name\"\n};\nvar _hoisted_13 = {\n  \"class\": \"emission-input\"\n};\nvar _hoisted_14 = [\"onUpdate:modelValue\"];\nvar _hoisted_15 = {\n  \"class\": \"unit\"\n};\nvar _hoisted_16 = {\n  \"class\": \"emission-value\"\n};\nvar _hoisted_17 = [\"onClick\"];\nvar _hoisted_18 = {\n  \"class\": \"total-section\"\n};\nvar _hoisted_19 = {\n  \"class\": \"total-value\"\n};\nvar _hoisted_20 = {\n  \"class\": \"trees-needed\"\n};\nvar _hoisted_21 = {\n  \"class\": \"tree-count\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"div\", _hoisted_3, [_cache[1] || (_cache[1] = _createElementVNode(\"h2\", null, \"类型\", -1 /* HOISTED */)), (_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.emissionFactors, function (items, category) {\n    return _openBlock(), _createElementBlock(\"div\", {\n      key: category,\n      \"class\": \"category-section\"\n    }, [_createElementVNode(\"div\", _hoisted_4, _toDisplayString(category), 1 /* TEXT */), _createElementVNode(\"div\", _hoisted_5, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList(items, function (factor, subCategory) {\n      return _openBlock(), _createElementBlock(\"div\", {\n        key: subCategory,\n        \"class\": _normalizeClass([\"subcategory-item\", {\n          selected: $options.isSelected(category, subCategory)\n        }]),\n        onClick: function onClick($event) {\n          return $options.selectSubcategory(category, subCategory);\n        }\n      }, [_createElementVNode(\"div\", _hoisted_7, [_createCommentVNode(\" 这里可以根据子类别添加对应的图标 \"), _createElementVNode(\"span\", null, _toDisplayString(subCategory.charAt(0)), 1 /* TEXT */)]), _createElementVNode(\"div\", _hoisted_8, _toDisplayString(subCategory), 1 /* TEXT */)], 10 /* CLASS, PROPS */, _hoisted_6);\n    }), 128 /* KEYED_FRAGMENT */))])]);\n  }), 128 /* KEYED_FRAGMENT */))]), _createElementVNode(\"div\", _hoisted_9, [_cache[7] || (_cache[7] = _createElementVNode(\"h2\", null, \"排放源\", -1 /* HOISTED */)), _cache[8] || (_cache[8] = _createElementVNode(\"p\", {\n    \"class\": \"hint\"\n  }, \"*输入数据最多可支持三位数(单位:kgCO₂e)\", -1 /* HOISTED */)), (_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.selectedItems, function (item, index) {\n    return _openBlock(), _createElementBlock(\"div\", {\n      key: index,\n      \"class\": \"emission-item\"\n    }, [_createElementVNode(\"div\", _hoisted_10, _toDisplayString(item.category), 1 /* TEXT */), _createElementVNode(\"div\", _hoisted_11, [_createElementVNode(\"div\", _hoisted_12, _toDisplayString(item.subCategory), 1 /* TEXT */), _createElementVNode(\"div\", _hoisted_13, [_withDirectives(_createElementVNode(\"input\", {\n      type: \"number\",\n      \"onUpdate:modelValue\": function onUpdateModelValue($event) {\n        return item.value = $event;\n      },\n      min: \"0.1\",\n      step: \"0.1\",\n      onInput: _cache[0] || (_cache[0] = function () {\n        return $options.calculateTotal && $options.calculateTotal.apply($options, arguments);\n      })\n    }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_14), [[_vModelText, item.value, void 0, {\n      number: true\n    }]]), _createElementVNode(\"span\", _hoisted_15, _toDisplayString($options.getUnit(item.subCategory)), 1 /* TEXT */)]), _createElementVNode(\"div\", _hoisted_16, _toDisplayString($options.getEmissionValue(item)), 1 /* TEXT */), _createElementVNode(\"button\", {\n      \"class\": \"remove-btn\",\n      onClick: function onClick($event) {\n        return $options.removeItem(index);\n      }\n    }, \"×\", 8 /* PROPS */, _hoisted_17)])]);\n  }), 128 /* KEYED_FRAGMENT */)), _createElementVNode(\"div\", _hoisted_18, [_cache[6] || (_cache[6] = _createElementVNode(\"h2\", null, \"总排放量\", -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_19, _toDisplayString($data.totalEmission) + \"kgCO₂e\", 1 /* TEXT */), _createElementVNode(\"div\", _hoisted_20, [_cache[2] || (_cache[2] = _createTextVNode(\" 您需要种植 \")), _createElementVNode(\"span\", _hoisted_21, _toDisplayString($data.treesToPlant), 1 /* TEXT */), _cache[3] || (_cache[3] = _createTextVNode(\" 棵树\")), _cache[4] || (_cache[4] = _createElementVNode(\"br\", null, null, -1 /* HOISTED */)), _cache[5] || (_cache[5] = _createTextVNode(\" 抵消这些碳排放，实现碳中和 \"))])])])])]);\n}","map":{"version":3,"names":["_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","_Fragment","_renderList","$data","emissionFactors","items","category","key","_hoisted_4","_toDisplayString","_hoisted_5","factor","subCategory","_normalizeClass","selected","$options","isSelected","onClick","$event","selectSubcategory","_hoisted_7","_createCommentVNode","charAt","_hoisted_8","_hoisted_6","_hoisted_9","selectedItems","item","index","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","type","onUpdateModelValue","value","min","step","onInput","_cache","calculateTotal","apply","arguments","_hoisted_14","number","_hoisted_15","getUnit","_hoisted_16","getEmissionValue","removeItem","_hoisted_17","_hoisted_18","_hoisted_19","totalEmission","_hoisted_20","_createTextVNode","_hoisted_21","treesToPlant"],"sources":["D:\\computer_design\\src\\components\\CarbonCalculator.vue"],"sourcesContent":["<template>\r\n  <div class=\"carbon-calculator\">\r\n    <div class=\"calculator-container\">\r\n      <div class=\"left-panel\">\r\n        <h2>类型</h2>\r\n        \r\n        <div v-for=\"(items, category) in emissionFactors\" :key=\"category\" class=\"category-section\">\r\n          <div class=\"category-title\">{{ category }}</div>\r\n          \r\n          <div class=\"subcategory-grid\">\r\n            <div \r\n              v-for=\"(factor, subCategory) in items\" \r\n              :key=\"subCategory\" \r\n              class=\"subcategory-item\"\r\n              :class=\"{ selected: isSelected(category, subCategory) }\"\r\n              @click=\"selectSubcategory(category, subCategory)\"\r\n            >\r\n              <div class=\"subcategory-icon\">\r\n                <!-- 这里可以根据子类别添加对应的图标 -->\r\n                <span>{{ subCategory.charAt(0) }}</span>\r\n              </div>\r\n              <div class=\"subcategory-name\">{{ subCategory }}</div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      <div class=\"right-panel\">\r\n        <h2>排放源</h2>\r\n        <p class=\"hint\">*输入数据最多可支持三位数(单位:kgCO₂e)</p>\r\n        \r\n        <div v-for=\"(item, index) in selectedItems\" :key=\"index\" class=\"emission-item\">\r\n          <div class=\"emission-category\">{{ item.category }}</div>\r\n          <div class=\"emission-details\">\r\n            <div class=\"emission-name\">{{ item.subCategory }}</div>\r\n            <div class=\"emission-input\">\r\n              <input \r\n                type=\"number\" \r\n                v-model.number=\"item.value\" \r\n                min=\"0.1\" \r\n                step=\"0.1\"\r\n                @input=\"calculateTotal\"\r\n              />\r\n              <span class=\"unit\">{{ getUnit(item.subCategory) }}</span>\r\n            </div>\r\n            <div class=\"emission-value\">{{ getEmissionValue(item) }}</div>\r\n            <button class=\"remove-btn\" @click=\"removeItem(index)\">×</button>\r\n          </div>\r\n        </div>\r\n        \r\n        <div class=\"total-section\">\r\n          <h2>总排放量</h2>\r\n          <div class=\"total-value\">{{ totalEmission }}kgCO₂e</div>\r\n          <div class=\"trees-needed\">\r\n            您需要种植 <span class=\"tree-count\">{{ treesToPlant }}</span> 棵树<br>\r\n            抵消这些碳排放，实现碳中和\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport axios from 'axios';\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      emissionFactors: {},\r\n      unitMap: {},\r\n      selectedItems: [],\r\n      totalEmission: 0,\r\n      treesToPlant: 0\r\n    };\r\n  },\r\n  async created() {\r\n    try {\r\n      const token = localStorage.getItem('token');\r\n      if (!token) {\r\n        this.$router.push('/');\r\n        return;\r\n      }\r\n      \r\n      // 获取碳排放系数\r\n      const response = await axios.get('http://localhost:5000/api/carbon/factors', {\r\n        headers: { Authorization: `Bearer ${token}` }\r\n      });\r\n      \r\n      this.emissionFactors = response.data.factors;\r\n      this.unitMap = response.data.units;\r\n    } catch (error) {\r\n      console.error('Error:', error);\r\n    }\r\n  },\r\n  methods: {\r\n    isSelected(category, subCategory) {\r\n      return this.selectedItems.some(item => \r\n        item.category === category && item.subCategory === subCategory\r\n      );\r\n    },\r\n    selectSubcategory(category, subCategory) {\r\n      // 检查是否已经选择了该子类别\r\n      if (this.isSelected(category, subCategory)) {\r\n        return;\r\n      }\r\n      \r\n      // 添加到选择列表\r\n      this.selectedItems.push({\r\n        category,\r\n        subCategory,\r\n        value: 1,\r\n        factor: this.emissionFactors[category][subCategory]\r\n      });\r\n      \r\n      this.calculateTotal();\r\n    },\r\n    removeItem(index) {\r\n      this.selectedItems.splice(index, 1);\r\n      this.calculateTotal();\r\n    },\r\n    getUnit(subCategory) {\r\n      return this.unitMap[subCategory] || '单位';\r\n    },\r\n    getEmissionValue(item) {\r\n      const value = (item.factor * item.value).toFixed(1);\r\n      return value;\r\n    },\r\n    calculateTotal() {\r\n      let total = 0;\r\n      for (const item of this.selectedItems) {\r\n        total += item.factor * item.value;\r\n      }\r\n      this.totalEmission = total.toFixed(1);\r\n      this.treesToPlant = (total / 28.8 * 0.3).toFixed(1);\r\n    },\r\n    async saveEmissions() {\r\n      try {\r\n        if (this.selectedItems.length === 0) {\r\n          alert('请至少选择一项排放源');\r\n          return;\r\n        }\r\n        \r\n        const emissions = this.selectedItems.map(item => ({\r\n          category: item.category,\r\n          subCategory: item.subCategory,\r\n          value: item.value\r\n        }));\r\n        \r\n        const token = localStorage.getItem('token');\r\n        await axios.post('http://localhost:5000/api/carbon/calculate', {\r\n          emissions\r\n        }, {\r\n          headers: { Authorization: `Bearer ${token}` }\r\n        });\r\n        \r\n        alert('碳排放数据已保存');\r\n      } catch (error) {\r\n        console.error('Error:', error);\r\n        alert('保存数据时发生错误');\r\n      }\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.carbon-calculator {\r\n  font-family: Arial, sans-serif;\r\n}\r\n\r\n.calculator-container {\r\n  display: flex;\r\n  gap: 20px;\r\n  max-width: 1200px;\r\n  margin: 0 auto;\r\n}\r\n\r\n.left-panel, .right-panel {\r\n  background-color: #f9f9f9;\r\n  border-radius: 8px;\r\n  padding: 20px;\r\n  box-shadow: 0 2px 4px rgba(0,0,0,0.1);\r\n}\r\n\r\n.left-panel {\r\n  flex: 1;\r\n}\r\n\r\n.right-panel {\r\n  flex: 1;\r\n}\r\n\r\nh2 {\r\n  color: #333;\r\n  border-bottom: 1px solid #eee;\r\n  padding-bottom: 10px;\r\n  margin-top: 0;\r\n}\r\n\r\n.hint {\r\n  color: #888;\r\n  font-size: 0.8rem;\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.category-section {\r\n  margin-bottom: 30px;\r\n}\r\n\r\n.category-title {\r\n  font-size: 24px;\r\n  font-weight: bold;\r\n  margin-bottom: 10px;\r\n  color: #333;\r\n}\r\n\r\n.subcategory-grid {\r\n  display: grid;\r\n  grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));\r\n  gap: 15px;\r\n}\r\n\r\n.subcategory-item {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  cursor: pointer;\r\n  padding: 10px;\r\n  border-radius: 8px;\r\n  transition: background-color 0.3s;\r\n}\r\n\r\n.subcategory-item:hover {\r\n  background-color: #f0f0f0;\r\n}\r\n\r\n.subcategory-item.selected {\r\n  background-color: #e1f5fe;\r\n}\r\n\r\n.subcategory-icon {\r\n  width: 50px;\r\n  height: 50px;\r\n  background-color: #e0e0e0;\r\n  border-radius: 50%;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  margin-bottom: 5px;\r\n}\r\n\r\n.subcategory-name {\r\n  font-size: 12px;\r\n  text-align: center;\r\n}\r\n\r\n.emission-item {\r\n  margin-bottom: 15px;\r\n  border-bottom: 1px solid #eee;\r\n  padding-bottom: 10px;\r\n}\r\n\r\n.emission-category {\r\n  font-size: 20px;\r\n  font-weight: bold;\r\n  margin-bottom: 5px;\r\n}\r\n\r\n.emission-details {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 10px;\r\n}\r\n\r\n.emission-name {\r\n  flex: 2;\r\n}\r\n\r\n.emission-input {\r\n  flex: 2;\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n.emission-input input {\r\n  width: 60px;\r\n  padding: 5px;\r\n  border: 1px solid #ccc;\r\n  border-radius: 4px;\r\n  text-align: center;\r\n}\r\n\r\n.unit {\r\n  margin-left: 5px;\r\n  color: #666;\r\n}\r\n\r\n.emission-value {\r\n  flex: 1;\r\n  color: #4caf50;\r\n  font-weight: bold;\r\n}\r\n\r\n.remove-btn {\r\n  background: none;\r\n  border: none;\r\n  color: #f44336;\r\n  font-size: 18px;\r\n  cursor: pointer;\r\n  padding: 0 5px;\r\n}\r\n\r\n.total-section {\r\n  margin-top: 30px;\r\n  background-color: #e8f5e9;\r\n  padding: 15px;\r\n  border-radius: 8px;\r\n  text-align: center;\r\n}\r\n\r\n.total-value {\r\n  font-size: 26px;\r\n  font-weight: bold;\r\n  color: #4caf50;\r\n  margin: 10px 0;\r\n}\r\n\r\n.trees-needed {\r\n  font-size: 14px;\r\n  color: #555;\r\n  line-height: 1.5;\r\n}\r\n\r\n.tree-count {\r\n  font-weight: bold;\r\n  color: #2e7d32;\r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}