{"ast":null,"code":"import \"core-js/modules/es.number.to-fixed.js\";\nimport { createElementVNode as _createElementVNode, createTextVNode as _createTextVNode, vModelSelect as _vModelSelect, withDirectives as _withDirectives, toDisplayString as _toDisplayString, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, normalizeClass as _normalizeClass } from \"vue\";\nvar _hoisted_1 = {\n  \"class\": \"leaderboard-page\"\n};\nvar _hoisted_2 = {\n  \"class\": \"leaderboard-header\"\n};\nvar _hoisted_3 = {\n  \"class\": \"update-section\"\n};\nvar _hoisted_4 = {\n  \"class\": \"filter-section\"\n};\nvar _hoisted_5 = {\n  key: 0,\n  \"class\": \"my-rank\"\n};\nvar _hoisted_6 = {\n  \"class\": \"rank-badge\"\n};\nvar _hoisted_7 = {\n  \"class\": \"rank-details\"\n};\nvar _hoisted_8 = {\n  \"class\": \"rank-username\"\n};\nvar _hoisted_9 = {\n  \"class\": \"rank-reduction\"\n};\nvar _hoisted_10 = {\n  \"class\": \"leaderboard-container\"\n};\nvar _hoisted_11 = {\n  \"class\": \"rank-column\"\n};\nvar _hoisted_12 = {\n  \"class\": \"user-column\"\n};\nvar _hoisted_13 = {\n  \"class\": \"reduction-column\"\n};\nvar _hoisted_14 = {\n  key: 0,\n  \"class\": \"no-data\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_cache[6] || (_cache[6] = _createElementVNode(\"h2\", null, \"碳减排排行榜\", -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"div\", _hoisted_3, [_createElementVNode(\"button\", {\n    onClick: _cache[0] || (_cache[0] = function () {\n      return $options.updateLeaderboard && $options.updateLeaderboard.apply($options, arguments);\n    }),\n    \"class\": \"update-btn\"\n  }, _cache[3] || (_cache[3] = [_createElementVNode(\"i\", {\n    \"class\": \"fas fa-sync-alt\"\n  }, null, -1 /* HOISTED */), _createTextVNode(\" 更新排名 \")]))]), _createElementVNode(\"div\", _hoisted_4, [_withDirectives(_createElementVNode(\"select\", {\n    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = function ($event) {\n      return $data.limit = $event;\n    }),\n    onChange: _cache[2] || (_cache[2] = function () {\n      return $options.loadLeaderboard && $options.loadLeaderboard.apply($options, arguments);\n    })\n  }, _cache[4] || (_cache[4] = [_createElementVNode(\"option\", {\n    value: 5\n  }, \"显示前5名\", -1 /* HOISTED */), _createElementVNode(\"option\", {\n    value: 10\n  }, \"显示前10名\", -1 /* HOISTED */), _createElementVNode(\"option\", {\n    value: 20\n  }, \"显示前20名\", -1 /* HOISTED */)]), 544 /* NEED_HYDRATION, NEED_PATCH */), [[_vModelSelect, $data.limit]])])]), $data.userRank ? (_openBlock(), _createElementBlock(\"div\", _hoisted_5, [_createElementVNode(\"div\", _hoisted_6, \"#\" + _toDisplayString($data.userRank.rank), 1 /* TEXT */), _createElementVNode(\"div\", _hoisted_7, [_createElementVNode(\"div\", _hoisted_8, _toDisplayString($data.username), 1 /* TEXT */), _createElementVNode(\"div\", _hoisted_9, \"减排量: \" + _toDisplayString($data.userRank.carbon_reduction.toFixed(1)) + \" kg CO₂\", 1 /* TEXT */)])])) : _createCommentVNode(\"v-if\", true), _createElementVNode(\"div\", _hoisted_10, [_cache[5] || (_cache[5] = _createElementVNode(\"div\", {\n    \"class\": \"leaderboard-row header\"\n  }, [_createElementVNode(\"div\", {\n    \"class\": \"rank-column\"\n  }, \"排名\"), _createElementVNode(\"div\", {\n    \"class\": \"user-column\"\n  }, \"用户\"), _createElementVNode(\"div\", {\n    \"class\": \"reduction-column\"\n  }, \"减排量 (kg CO₂)\")], -1 /* HOISTED */)), (_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.leaderboard, function (entry, index) {\n    return _openBlock(), _createElementBlock(\"div\", {\n      key: index,\n      \"class\": _normalizeClass([\"leaderboard-row\", {\n        'highlighted': $options.isCurrentUser(entry.user_id)\n      }])\n    }, [_createElementVNode(\"div\", _hoisted_11, [_createElementVNode(\"div\", {\n      \"class\": _normalizeClass([\"rank-number\", $options.getRankClass(entry.rank)])\n    }, _toDisplayString(entry.rank), 3 /* TEXT, CLASS */)]), _createElementVNode(\"div\", _hoisted_12, _toDisplayString(entry.username), 1 /* TEXT */), _createElementVNode(\"div\", _hoisted_13, _toDisplayString(entry.carbon_reduction.toFixed(1)), 1 /* TEXT */)], 2 /* CLASS */);\n  }), 128 /* KEYED_FRAGMENT */)), $data.leaderboard.length === 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_14, \" 暂无排行数据 \")) : _createCommentVNode(\"v-if\", true)]), _cache[7] || (_cache[7] = _createElementVNode(\"div\", {\n    \"class\": \"leaderboard-tips\"\n  }, [_createElementVNode(\"h3\", null, \"如何提高排名?\"), _createElementVNode(\"ul\", null, [_createElementVNode(\"li\", null, \"多步行减少碳排放\"), _createElementVNode(\"li\", null, \"通过碳排放计算器记录您的低碳行为\"), _createElementVNode(\"li\", null, \"喂养并升级您的虚拟宠物\"), _createElementVNode(\"li\", null, \"完成成就任务获得额外奖励\")])], -1 /* HOISTED */))]);\n}","map":{"version":3,"names":["key","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","onClick","_cache","$options","updateLeaderboard","apply","arguments","_createTextVNode","_hoisted_4","$event","$data","limit","onChange","loadLeaderboard","value","userRank","_hoisted_5","_hoisted_6","_toDisplayString","rank","_hoisted_7","_hoisted_8","username","_hoisted_9","carbon_reduction","toFixed","_createCommentVNode","_hoisted_10","_Fragment","_renderList","leaderboard","entry","index","_normalizeClass","isCurrentUser","user_id","_hoisted_11","getRankClass","_hoisted_12","_hoisted_13","length","_hoisted_14"],"sources":["D:\\EcoPaw\\carbonfootprint\\src\\components\\Leaderboard.vue"],"sourcesContent":["<template>\r\n  <div class=\"leaderboard-page\">\r\n    <h2>碳减排排行榜</h2>\r\n    \r\n    <div class=\"leaderboard-header\">\r\n      <div class=\"update-section\">\r\n        <button @click=\"updateLeaderboard\" class=\"update-btn\">\r\n          <i class=\"fas fa-sync-alt\"></i> 更新排名\r\n        </button>\r\n      </div>\r\n      \r\n      <div class=\"filter-section\">\r\n        <select v-model=\"limit\" @change=\"loadLeaderboard\">\r\n          <option :value=\"5\">显示前5名</option>\r\n          <option :value=\"10\">显示前10名</option>\r\n          <option :value=\"20\">显示前20名</option>\r\n        </select>\r\n      </div>\r\n    </div>\r\n    \r\n    <div class=\"my-rank\" v-if=\"userRank\">\r\n      <div class=\"rank-badge\">#{{ userRank.rank }}</div>\r\n      <div class=\"rank-details\">\r\n        <div class=\"rank-username\">{{ username }}</div>\r\n        <div class=\"rank-reduction\">减排量: {{ userRank.carbon_reduction.toFixed(1) }} kg CO₂</div>\r\n      </div>\r\n    </div>\r\n    \r\n    <div class=\"leaderboard-container\">\r\n      <div class=\"leaderboard-row header\">\r\n        <div class=\"rank-column\">排名</div>\r\n        <div class=\"user-column\">用户</div>\r\n        <div class=\"reduction-column\">减排量 (kg CO₂)</div>\r\n      </div>\r\n      \r\n      <div v-for=\"(entry, index) in leaderboard\" :key=\"index\" \r\n           class=\"leaderboard-row\" \r\n           :class=\"{ 'highlighted': isCurrentUser(entry.user_id) }\">\r\n        <div class=\"rank-column\">\r\n          <div class=\"rank-number\" :class=\"getRankClass(entry.rank)\">{{ entry.rank }}</div>\r\n        </div>\r\n        <div class=\"user-column\">{{ entry.username }}</div>\r\n        <div class=\"reduction-column\">{{ entry.carbon_reduction.toFixed(1) }}</div>\r\n      </div>\r\n      \r\n      <div v-if=\"leaderboard.length === 0\" class=\"no-data\">\r\n        暂无排行数据\r\n      </div>\r\n    </div>\r\n    \r\n    <div class=\"leaderboard-tips\">\r\n      <h3>如何提高排名?</h3>\r\n      <ul>\r\n        <li>多步行减少碳排放</li>\r\n        <li>通过碳排放计算器记录您的低碳行为</li>\r\n        <li>喂养并升级您的虚拟宠物</li>\r\n        <li>完成成就任务获得额外奖励</li>\r\n      </ul>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport axios from 'axios';\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      leaderboard: [],\r\n      userRank: null,\r\n      username: '',\r\n      limit: 10\r\n    };\r\n  },\r\n  async created() {\r\n    try {\r\n      const token = localStorage.getItem('token');\r\n      if (!token) {\r\n        this.$router.push('/');\r\n        return;\r\n      }\r\n      \r\n      // 获取用户信息\r\n      const userResponse = await axios.get('http://localhost:5000/api/auth/user', {\r\n        headers: { Authorization: `Bearer ${token}` }\r\n      });\r\n      this.username = userResponse.data.username;\r\n      \r\n      await this.loadLeaderboard();\r\n    } catch (error) {\r\n      console.error('Error loading leaderboard data:', error);\r\n    }\r\n  },\r\n  methods: {\r\n    async loadLeaderboard() {\r\n      try {\r\n        const token = localStorage.getItem('token');\r\n        const response = await axios.get(`http://localhost:5000/api/leaderboard?limit=${this.limit}`, {\r\n          headers: { Authorization: `Bearer ${token}` }\r\n        });\r\n        \r\n        this.leaderboard = response.data.leaderboard;\r\n        this.userRank = response.data.userRank;\r\n      } catch (error) {\r\n        console.error('Error loading leaderboard:', error);\r\n      }\r\n    },\r\n    \r\n    async updateLeaderboard() {\r\n      try {\r\n        const token = localStorage.getItem('token');\r\n        await axios.post('http://localhost:5000/api/leaderboard/update', {}, {\r\n          headers: { Authorization: `Bearer ${token}` }\r\n        });\r\n        \r\n        await this.loadLeaderboard();\r\n        alert('排行榜已更新');\r\n      } catch (error) {\r\n        console.error('Error updating leaderboard:', error);\r\n      }\r\n    },\r\n    \r\n    isCurrentUser(userId) {\r\n      return this.userRank && this.userRank.user_id === userId;\r\n    },\r\n    \r\n    getRankClass(rank) {\r\n      if (rank === 1) return 'gold';\r\n      if (rank === 2) return 'silver';\r\n      if (rank === 3) return 'bronze';\r\n      return '';\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.leaderboard-page {\r\n  max-width: 800px;\r\n  margin: 0 auto;\r\n  padding: 20px;\r\n  font-family: 'Arial', sans-serif;\r\n}\r\n\r\n.leaderboard-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.update-btn {\r\n  background-color: #2196F3;\r\n  color: white;\r\n  border: none;\r\n  border-radius: 20px;\r\n  padding: 8px 16px;\r\n  cursor: pointer;\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 8px;\r\n  transition: background-color 0.3s;\r\n}\r\n\r\n.update-btn:hover {\r\n  background-color: #1976D2;\r\n}\r\n\r\n.filter-section select {\r\n  padding: 8px;\r\n  border-radius: 4px;\r\n  border: 1px solid #ddd;\r\n}\r\n\r\n.my-rank {\r\n  background-color: #e3f2fd;\r\n  border-radius: 8px;\r\n  padding: 15px;\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 15px;\r\n  margin-bottom: 20px;\r\n  box-shadow: 0 2px 4px rgba(0,0,0,0.1);\r\n}\r\n\r\n.rank-badge {\r\n  background-color: #2196F3;\r\n  color: white;\r\n  width: 40px;\r\n  height: 40px;\r\n  border-radius: 50%;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  font-weight: bold;\r\n}\r\n\r\n.rank-details {\r\n  flex: 1;\r\n}\r\n\r\n.rank-username {\r\n  font-weight: bold;\r\n  font-size: 16px;\r\n}\r\n\r\n.rank-reduction {\r\n  color: #4CAF50;\r\n  font-size: 14px;\r\n}\r\n\r\n.leaderboard-container {\r\n  background-color: #fff;\r\n  border-radius: 8px;\r\n  overflow: hidden;\r\n  box-shadow: 0 2px 4px rgba(0,0,0,0.1);\r\n  margin-bottom: 30px;\r\n}\r\n\r\n.leaderboard-row {\r\n  display: flex;\r\n  padding: 12px 15px;\r\n  border-bottom: 1px solid #eee;\r\n}\r\n\r\n.leaderboard-row:last-child {\r\n  border-bottom: none;\r\n}\r\n\r\n.leaderboard-row.header {\r\n  background-color: #f5f5f5;\r\n  font-weight: bold;\r\n  color: #555;\r\n}\r\n\r\n.leaderboard-row.highlighted {\r\n  background-color: #e8f5e9;\r\n}\r\n\r\n.rank-column {\r\n  width: 70px;\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n.user-column {\r\n  flex: 1;\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n.reduction-column {\r\n  width: 150px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: flex-end;\r\n  color: #4CAF50;\r\n  font-weight: bold;\r\n}\r\n\r\n.rank-number {\r\n  width: 30px;\r\n  height: 30px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  border-radius: 50%;\r\n  background-color: #eee;\r\n  font-size: 14px;\r\n}\r\n\r\n.rank-number.gold {\r\n  background-color: #FFD700;\r\n  color: #fff;\r\n}\r\n\r\n.rank-number.silver {\r\n  background-color: #C0C0C0;\r\n  color: #fff;\r\n}\r\n\r\n.rank-number.bronze {\r\n  background-color: #CD7F32;\r\n  color: #fff;\r\n}\r\n\r\n.no-data {\r\n  padding: 30px;\r\n  text-align: center;\r\n  color: #999;\r\n  font-style: italic;\r\n}\r\n\r\n.leaderboard-tips {\r\n  background-color: #f9f9f9;\r\n  border-radius: 8px;\r\n  padding: 15px;\r\n  box-shadow: 0 2px 4px rgba(0,0,0,0.1);\r\n}\r\n\r\n.leaderboard-tips h3 {\r\n  margin-top: 0;\r\n  color: #555;\r\n}\r\n\r\n.leaderboard-tips ul {\r\n  margin: 0;\r\n  padding-left: 20px;\r\n}\r\n\r\n.leaderboard-tips li {\r\n  margin-bottom: 8px;\r\n  color: #666;\r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}