{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/ASUS/Desktop/ECO_PAW/carbonfootprint/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"C:/Users/ASUS/Desktop/ECO_PAW/carbonfootprint/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _objectSpread from \"C:/Users/ASUS/Desktop/ECO_PAW/carbonfootprint/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.every.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.array.find.js\";\nimport \"core-js/modules/es.array.find-index.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.array.reduce.js\";\nimport \"core-js/modules/es.array.some.js\";\nimport \"core-js/modules/es.array.splice.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.every.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.iterator.reduce.js\";\nimport \"core-js/modules/es.iterator.some.js\";\nimport \"core-js/modules/es.number.to-fixed.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.parse-float.js\";\nimport \"core-js/modules/web.timers.js\";\nimport { ref, computed } from 'vue';\nimport { useStore } from 'vuex';\nimport { useRouter } from 'vue-router';\nimport { getAPI } from '@/config/api';\nexport default {\n  name: 'CarbonReductionCalculator',\n  emits: ['reductionSaved'],\n  setup: function setup(props, _ref) {\n    var emit = _ref.emit;\n    var store = useStore();\n    var router = useRouter();\n    var showSuccess = ref(false);\n    var showError = ref(false);\n    var errorMessage = ref('');\n    var isSaving = ref(false);\n\n    // 减碳活动分类\n    var categories = [{\n      id: 'transport',\n      name: '交通出行',\n      icon: 'fas fa-car'\n    }, {\n      id: 'energy',\n      name: '能源使用',\n      icon: 'fas fa-bolt'\n    }, {\n      id: 'food',\n      name: '饮食选择',\n      icon: 'fas fa-utensils'\n    }, {\n      id: 'waste',\n      name: '垃圾处理',\n      icon: 'fas fa-trash'\n    }, {\n      id: 'lifestyle',\n      name: '生活方式',\n      icon: 'fas fa-heart'\n    }];\n\n    // 减碳活动列表\n    var activities = [{\n      id: 'bike',\n      category: 'transport',\n      name: '骑自行车出行',\n      description: '使用自行车代替机动车出行',\n      icon: 'fas fa-bicycle',\n      factor: 0.2,\n      unit: '公里'\n    }, {\n      id: 'public_transport',\n      category: 'transport',\n      name: '乘坐公共交通',\n      description: '使用公交、地铁等公共交通工具',\n      icon: 'fas fa-bus',\n      factor: 0.1,\n      unit: '公里'\n    }, {\n      id: 'walk',\n      category: 'transport',\n      name: '步行出行',\n      description: '选择步行代替其他交通方式',\n      icon: 'fas fa-walking',\n      factor: 0.05,\n      unit: '公里'\n    }, {\n      id: 'led_light',\n      category: 'energy',\n      name: '使用LED灯',\n      description: '使用LED节能灯泡',\n      icon: 'fas fa-lightbulb',\n      factor: 0.02,\n      unit: '小时'\n    }, {\n      id: 'solar_panel',\n      category: 'energy',\n      name: '使用太阳能',\n      description: '使用太阳能热水器或发电',\n      icon: 'fas fa-solar-panel',\n      factor: 0.5,\n      unit: '千瓦时'\n    }, {\n      id: 'vegetarian',\n      category: 'food',\n      name: '素食饮食',\n      description: '选择素食代替肉类',\n      icon: 'fas fa-leaf',\n      factor: 0.3,\n      unit: '餐'\n    }, {\n      id: 'local_food',\n      category: 'food',\n      name: '本地食材',\n      description: '选择本地生产的食材',\n      icon: 'fas fa-store',\n      factor: 0.1,\n      unit: '公斤'\n    }, {\n      id: 'recycle',\n      category: 'waste',\n      name: '垃圾分类回收',\n      description: '正确分类和回收垃圾',\n      icon: 'fas fa-recycle',\n      factor: 0.15,\n      unit: '公斤'\n    }, {\n      id: 'compost',\n      category: 'waste',\n      name: '厨余堆肥',\n      description: '将厨余垃圾进行堆肥处理',\n      icon: 'fas fa-seedling',\n      factor: 0.2,\n      unit: '公斤'\n    }, {\n      id: 'reusable_bag',\n      category: 'lifestyle',\n      name: '使用环保袋',\n      description: '使用可重复使用的购物袋',\n      icon: 'fas fa-shopping-bag',\n      factor: 0.01,\n      unit: '次'\n    }, {\n      id: 'reusable_bottle',\n      category: 'lifestyle',\n      name: '使用环保水杯',\n      description: '使用可重复使用的水杯',\n      icon: 'fas fa-glass-whiskey',\n      factor: 0.02,\n      unit: '次'\n    }];\n    var activeCategory = ref('transport');\n    var selectedActivities = ref([]);\n    var totalReduction = ref(0);\n\n    // 根据当前分类筛选活动\n    var filteredActivities = computed(function () {\n      return activities.filter(function (activity) {\n        return activity.category === activeCategory.value;\n      });\n    });\n\n    // 设置当前活动分类\n    var setActiveCategory = function setActiveCategory(categoryId) {\n      activeCategory.value = categoryId;\n    };\n\n    // 检查活动是否已选择\n    var isActivitySelected = function isActivitySelected(activityId) {\n      return selectedActivities.value.some(function (activity) {\n        return activity.id === activityId;\n      });\n    };\n\n    // 切换活动选择状态\n    var toggleActivity = function toggleActivity(activity) {\n      var index = selectedActivities.value.findIndex(function (item) {\n        return item.id === activity.id;\n      });\n      if (index === -1) {\n        selectedActivities.value.push(_objectSpread(_objectSpread({}, activity), {}, {\n          amount: 0\n        }));\n      } else {\n        selectedActivities.value.splice(index, 1);\n      }\n      calculateTotalReduction();\n    };\n\n    // 移除已选活动\n    var removeActivity = function removeActivity(activityId) {\n      selectedActivities.value = selectedActivities.value.filter(function (activity) {\n        return activity.id !== activityId;\n      });\n      calculateTotalReduction();\n    };\n\n    // 计算总减碳量\n    var calculateTotalReduction = function calculateTotalReduction() {\n      totalReduction.value = selectedActivities.value.reduce(function (total, activity) {\n        return total + activity.amount * activity.factor;\n      }, 0);\n    };\n\n    // 检查是否可以保存\n    var canSave = computed(function () {\n      return selectedActivities.value.length > 0 && selectedActivities.value.every(function (activity) {\n        return activity.amount > 0;\n      });\n    });\n\n    // 保存减碳记录\n    var saveReduction = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        var invalidActivity, activitiesData, token, api, response, newTotal, _response$data, _error$response, _error$response2, _error$response3, serverError, serverDetails;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              if (!(!canSave.value || isSaving.value)) {\n                _context2.next = 2;\n                break;\n              }\n              return _context2.abrupt(\"return\");\n            case 2:\n              isSaving.value = true;\n              showSuccess.value = false;\n              showError.value = false;\n\n              // 检查输入值的有效性\n              invalidActivity = selectedActivities.value.find(function (activity) {\n                return !activity.amount || isNaN(activity.amount) || activity.amount <= 0;\n              });\n              if (!invalidActivity) {\n                _context2.next = 11;\n                break;\n              }\n              showError.value = true;\n              errorMessage.value = \"\\u8BF7\\u4E3A\\u300C\".concat(invalidActivity.name, \"\\u300D\\u8F93\\u5165\\u6709\\u6548\\u7684\\u6570\\u91CF\");\n              isSaving.value = false;\n              return _context2.abrupt(\"return\");\n            case 11:\n              _context2.prev = 11;\n              // 准备提交的数据，确保reduction是数字类型\n              activitiesData = selectedActivities.value.map(function (activity) {\n                return {\n                  id: activity.id,\n                  name: activity.name,\n                  amount: parseFloat(activity.amount),\n                  reduction: parseFloat((activity.amount * activity.factor).toFixed(2))\n                };\n              });\n              console.log('发送减碳数据:', activitiesData);\n\n              // 检查用户token是否存在\n              token = localStorage.getItem('token');\n              if (token) {\n                _context2.next = 20;\n                break;\n              }\n              showError.value = true;\n              errorMessage.value = '未登录或会话已过期，请重新登录';\n              isSaving.value = false;\n              return _context2.abrupt(\"return\");\n            case 20:\n              console.log('请求开始，准备发送POST请求到:', '/carbon/reduction');\n              _context2.prev = 21;\n              // 获取配置好的axios实例\n              api = getAPI(); // 打印请求配置\n              console.log('API配置:', {\n                baseURL: api.defaults.baseURL,\n                timeout: api.defaults.timeout,\n                headers: api.defaults.headers\n              });\n\n              // 发送请求\n              _context2.next = 26;\n              return api.post('/carbon/reduction', {\n                activities: activitiesData\n              });\n            case 26:\n              response = _context2.sent;\n              console.log('请求成功，服务器响应:', response.data);\n              if (response.data && response.data.success) {\n                // 清空已选活动\n                selectedActivities.value = [];\n                // 重置总减碳量\n                totalReduction.value = 0;\n\n                // 显示成功消息\n                showSuccess.value = true;\n\n                // 通知父组件更新用户减碳总量\n                newTotal = response.data.data.newTotalReduction || 0;\n                console.log('新的减碳总量:', newTotal);\n                emit('reductionSaved', newTotal);\n\n                // 延迟刷新\n                setTimeout(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n                  return _regeneratorRuntime().wrap(function _callee$(_context) {\n                    while (1) switch (_context.prev = _context.next) {\n                      case 0:\n                        _context.prev = 0;\n                        _context.next = 3;\n                        return store.dispatch('updateUserCarbonReduction');\n                      case 3:\n                        _context.next = 5;\n                        return store.dispatch('syncLeaderboardWithCarbonReduction');\n                      case 5:\n                        console.log('已同步排名系统数据');\n                        _context.next = 11;\n                        break;\n                      case 8:\n                        _context.prev = 8;\n                        _context.t0 = _context[\"catch\"](0);\n                        console.error('刷新数据失败:', _context.t0);\n                      case 11:\n                      case \"end\":\n                        return _context.stop();\n                    }\n                  }, _callee, null, [[0, 8]]);\n                })), 1500);\n              } else {\n                showError.value = true;\n                errorMessage.value = ((_response$data = response.data) === null || _response$data === void 0 ? void 0 : _response$data.error) || '保存失败，请重试';\n                console.error('保存失败，响应中没有success标志:', response.data);\n              }\n              _context2.next = 35;\n              break;\n            case 31:\n              _context2.prev = 31;\n              _context2.t0 = _context2[\"catch\"](21);\n              console.error('API调用失败:', _context2.t0);\n              throw _context2.t0;\n            case 35:\n              _context2.next = 44;\n              break;\n            case 37:\n              _context2.prev = 37;\n              _context2.t1 = _context2[\"catch\"](11);\n              console.error('保存减碳记录失败:', _context2.t1);\n              showError.value = true;\n\n              // 提取详细的错误信息\n              serverError = ((_error$response = _context2.t1.response) === null || _error$response === void 0 || (_error$response = _error$response.data) === null || _error$response === void 0 ? void 0 : _error$response.error) || ((_error$response2 = _context2.t1.response) === null || _error$response2 === void 0 || (_error$response2 = _error$response2.data) === null || _error$response2 === void 0 ? void 0 : _error$response2.message);\n              serverDetails = (_error$response3 = _context2.t1.response) === null || _error$response3 === void 0 || (_error$response3 = _error$response3.data) === null || _error$response3 === void 0 ? void 0 : _error$response3.details;\n              if (serverError) {\n                errorMessage.value = serverDetails ? \"\".concat(serverError, \": \").concat(serverDetails) : serverError;\n                console.error('服务器返回错误:', serverError, serverDetails);\n              } else if (_context2.t1.request) {\n                // 请求发出但没有收到响应\n                errorMessage.value = '服务器无响应，请检查网络连接';\n                console.error('请求无响应:', _context2.t1.request);\n              } else {\n                // 请求设置或发送前出错\n                errorMessage.value = '请求发送失败，请稍后重试';\n                console.error('请求发送错误:', _context2.t1.message);\n              }\n            case 44:\n              _context2.prev = 44;\n              isSaving.value = false;\n              return _context2.finish(44);\n            case 47:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, null, [[11, 37, 44, 47], [21, 31]]);\n      }));\n      return function saveReduction() {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n    return {\n      categories: categories,\n      activeCategory: activeCategory,\n      filteredActivities: filteredActivities,\n      selectedActivities: selectedActivities,\n      totalReduction: totalReduction,\n      showSuccess: showSuccess,\n      showError: showError,\n      errorMessage: errorMessage,\n      isSaving: isSaving,\n      canSave: canSave,\n      setActiveCategory: setActiveCategory,\n      isActivitySelected: isActivitySelected,\n      toggleActivity: toggleActivity,\n      removeActivity: removeActivity,\n      calculateTotalReduction: calculateTotalReduction,\n      saveReduction: saveReduction\n    };\n  }\n};","map":{"version":3,"names":["ref","computed","useStore","useRouter","getAPI","name","emits","setup","props","_ref","emit","store","router","showSuccess","showError","errorMessage","isSaving","categories","id","icon","activities","category","description","factor","unit","activeCategory","selectedActivities","totalReduction","filteredActivities","filter","activity","value","setActiveCategory","categoryId","isActivitySelected","activityId","some","toggleActivity","index","findIndex","item","push","_objectSpread","amount","splice","calculateTotalReduction","removeActivity","reduce","total","canSave","length","every","saveReduction","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee2","invalidActivity","activitiesData","token","api","response","newTotal","_response$data","_error$response","_error$response2","_error$response3","serverError","serverDetails","wrap","_callee2$","_context2","prev","next","abrupt","find","isNaN","concat","map","parseFloat","reduction","toFixed","console","log","localStorage","getItem","baseURL","defaults","timeout","headers","post","sent","data","success","newTotalReduction","setTimeout","_callee","_callee$","_context","dispatch","t0","error","stop","t1","message","details","request","finish","apply","arguments"],"sources":["C:\\Users\\ASUS\\Desktop\\ECO_PAW\\carbonfootprint\\src\\components\\CarbonReductionCalculator.vue"],"sourcesContent":["<template>\r\n  <div class=\"carbon-reduction-calculator\">\r\n    <div class=\"calculator-container\">\r\n      <!-- 左侧分类列表 -->\r\n      <div class=\"category-list\">\r\n        <div\r\n          v-for=\"category in categories\"\r\n          :key=\"category.id\"\r\n          class=\"category-item\"\r\n          :class=\"{ active: activeCategory === category.id }\"\r\n          @click=\"setActiveCategory(category.id)\"\r\n        >\r\n          <i :class=\"category.icon\"></i>\r\n          <span>{{ category.name }}</span>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- 中间活动列表 -->\r\n      <div class=\"activity-list\">\r\n        <div\r\n          v-for=\"activity in filteredActivities\"\r\n          :key=\"activity.id\"\r\n          class=\"activity-item\"\r\n          :class=\"{ selected: isActivitySelected(activity.id) }\"\r\n          @click=\"toggleActivity(activity)\"\r\n        >\r\n          <div class=\"activity-icon\">\r\n            <i :class=\"activity.icon\"></i>\r\n          </div>\r\n          <div class=\"activity-info\">\r\n            <h3>{{ activity.name }}</h3>\r\n            <p>{{ activity.description }}</p>\r\n            <div class=\"activity-factor\">\r\n              <span>减碳系数：</span>\r\n              <span class=\"factor-value\">{{ activity.factor }} kgCO₂e/{{ activity.unit }}</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- 右侧计算面板 -->\r\n      <div class=\"calculation-panel\">\r\n        <div class=\"selected-activities\">\r\n          <h3>已选减碳活动</h3>\r\n          <div v-if=\"selectedActivities.length === 0\" class=\"no-activities\">\r\n            <i class=\"fas fa-info-circle\"></i>\r\n            <p>请从左侧选择减碳活动</p>\r\n          </div>\r\n          <div v-else class=\"activity-inputs\">\r\n            <div v-for=\"activity in selectedActivities\" :key=\"activity.id\" class=\"activity-input\">\r\n              <div class=\"activity-header\">\r\n                <span>{{ activity.name }}</span>\r\n                <button class=\"remove-btn\" @click=\"removeActivity(activity.id)\">\r\n                  <i class=\"fas fa-times\"></i>\r\n                </button>\r\n              </div>\r\n              <div class=\"input-group\">\r\n                <input\r\n                  type=\"number\"\r\n                  v-model=\"activity.amount\"\r\n                  :placeholder=\"'输入' + activity.unit\"\r\n                  min=\"0\"\r\n                  @input=\"calculateTotalReduction\"\r\n                />\r\n                <span class=\"unit\">{{ activity.unit }}</span>\r\n              </div>\r\n              <div class=\"reduction-amount\">\r\n                减碳量：{{ (activity.amount * activity.factor).toFixed(2) }} kgCO₂e\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"total-reduction\">\r\n          <div class=\"total-header\">\r\n            <h3>总减碳量</h3>\r\n            <span class=\"total-value\">{{ totalReduction.toFixed(2) }} kgCO₂e</span>\r\n          </div>\r\n          <div class=\"tree-equivalent\">\r\n            <i class=\"fas fa-tree\"></i>\r\n            <span>相当于种植了 {{ (totalReduction / 18).toFixed(1) }} 棵树</span>\r\n          </div>\r\n        </div>\r\n\r\n        <button\r\n          class=\"save-btn\"\r\n          :disabled=\"!canSave || isSaving\"\r\n          @click=\"saveReduction\"\r\n        >\r\n          <i class=\"fas fa-save\" v-if=\"!isSaving\"></i>\r\n          <i class=\"fas fa-spinner fa-spin\" v-else></i>\r\n          {{ isSaving ? '保存中...' : '保存减碳记录' }}\r\n        </button>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- 保存成功提示 -->\r\n    <div v-if=\"showSuccess\" class=\"success-message success\">\r\n      <i class=\"fas fa-check-circle\"></i>\r\n      <div class=\"message-content\">\r\n        <div class=\"message-title\">减碳记录保存成功！</div>\r\n      </div>\r\n      <button class=\"close-message-btn\" @click=\"showSuccess = false\">\r\n        <i class=\"fas fa-times\"></i>\r\n      </button>\r\n    </div>\r\n    \r\n    <!-- 保存失败提示 -->\r\n    <div v-if=\"showError\" class=\"success-message error\">\r\n      <i class=\"fas fa-exclamation-circle\"></i>\r\n      <div class=\"message-content\">\r\n        <div class=\"message-title\">保存失败</div>\r\n        <div class=\"message-detail\">{{ errorMessage }}</div>\r\n      </div>\r\n      <button class=\"close-message-btn\" @click=\"showError = false\">\r\n        <i class=\"fas fa-times\"></i>\r\n      </button>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { ref, computed } from 'vue'\r\nimport { useStore } from 'vuex'\r\nimport { useRouter } from 'vue-router'\r\nimport { getAPI } from '@/config/api'\r\n\r\nexport default {\r\n  name: 'CarbonReductionCalculator',\r\n  emits: ['reductionSaved'],\r\n  setup(props, { emit }) {\r\n    const store = useStore()\r\n    const router = useRouter()\r\n    const showSuccess = ref(false)\r\n    const showError = ref(false)\r\n    const errorMessage = ref('')\r\n    const isSaving = ref(false)\r\n\r\n    // 减碳活动分类\r\n    const categories = [\r\n      { id: 'transport', name: '交通出行', icon: 'fas fa-car' },\r\n      { id: 'energy', name: '能源使用', icon: 'fas fa-bolt' },\r\n      { id: 'food', name: '饮食选择', icon: 'fas fa-utensils' },\r\n      { id: 'waste', name: '垃圾处理', icon: 'fas fa-trash' },\r\n      { id: 'lifestyle', name: '生活方式', icon: 'fas fa-heart' }\r\n    ]\r\n\r\n    // 减碳活动列表\r\n    const activities = [\r\n      {\r\n        id: 'bike',\r\n        category: 'transport',\r\n        name: '骑自行车出行',\r\n        description: '使用自行车代替机动车出行',\r\n        icon: 'fas fa-bicycle',\r\n        factor: 0.2,\r\n        unit: '公里'\r\n      },\r\n      {\r\n        id: 'public_transport',\r\n        category: 'transport',\r\n        name: '乘坐公共交通',\r\n        description: '使用公交、地铁等公共交通工具',\r\n        icon: 'fas fa-bus',\r\n        factor: 0.1,\r\n        unit: '公里'\r\n      },\r\n      {\r\n        id: 'walk',\r\n        category: 'transport',\r\n        name: '步行出行',\r\n        description: '选择步行代替其他交通方式',\r\n        icon: 'fas fa-walking',\r\n        factor: 0.05,\r\n        unit: '公里'\r\n      },\r\n      {\r\n        id: 'led_light',\r\n        category: 'energy',\r\n        name: '使用LED灯',\r\n        description: '使用LED节能灯泡',\r\n        icon: 'fas fa-lightbulb',\r\n        factor: 0.02,\r\n        unit: '小时'\r\n      },\r\n      {\r\n        id: 'solar_panel',\r\n        category: 'energy',\r\n        name: '使用太阳能',\r\n        description: '使用太阳能热水器或发电',\r\n        icon: 'fas fa-solar-panel',\r\n        factor: 0.5,\r\n        unit: '千瓦时'\r\n      },\r\n      {\r\n        id: 'vegetarian',\r\n        category: 'food',\r\n        name: '素食饮食',\r\n        description: '选择素食代替肉类',\r\n        icon: 'fas fa-leaf',\r\n        factor: 0.3,\r\n        unit: '餐'\r\n      },\r\n      {\r\n        id: 'local_food',\r\n        category: 'food',\r\n        name: '本地食材',\r\n        description: '选择本地生产的食材',\r\n        icon: 'fas fa-store',\r\n        factor: 0.1,\r\n        unit: '公斤'\r\n      },\r\n      {\r\n        id: 'recycle',\r\n        category: 'waste',\r\n        name: '垃圾分类回收',\r\n        description: '正确分类和回收垃圾',\r\n        icon: 'fas fa-recycle',\r\n        factor: 0.15,\r\n        unit: '公斤'\r\n      },\r\n      {\r\n        id: 'compost',\r\n        category: 'waste',\r\n        name: '厨余堆肥',\r\n        description: '将厨余垃圾进行堆肥处理',\r\n        icon: 'fas fa-seedling',\r\n        factor: 0.2,\r\n        unit: '公斤'\r\n      },\r\n      {\r\n        id: 'reusable_bag',\r\n        category: 'lifestyle',\r\n        name: '使用环保袋',\r\n        description: '使用可重复使用的购物袋',\r\n        icon: 'fas fa-shopping-bag',\r\n        factor: 0.01,\r\n        unit: '次'\r\n      },\r\n      {\r\n        id: 'reusable_bottle',\r\n        category: 'lifestyle',\r\n        name: '使用环保水杯',\r\n        description: '使用可重复使用的水杯',\r\n        icon: 'fas fa-glass-whiskey',\r\n        factor: 0.02,\r\n        unit: '次'\r\n      }\r\n    ]\r\n\r\n    const activeCategory = ref('transport')\r\n    const selectedActivities = ref([])\r\n    const totalReduction = ref(0)\r\n\r\n    // 根据当前分类筛选活动\r\n    const filteredActivities = computed(() => {\r\n      return activities.filter(activity => activity.category === activeCategory.value)\r\n    })\r\n\r\n    // 设置当前活动分类\r\n    const setActiveCategory = (categoryId) => {\r\n      activeCategory.value = categoryId\r\n    }\r\n\r\n    // 检查活动是否已选择\r\n    const isActivitySelected = (activityId) => {\r\n      return selectedActivities.value.some(activity => activity.id === activityId)\r\n    }\r\n\r\n    // 切换活动选择状态\r\n    const toggleActivity = (activity) => {\r\n      const index = selectedActivities.value.findIndex(item => item.id === activity.id)\r\n      if (index === -1) {\r\n        selectedActivities.value.push({\r\n          ...activity,\r\n          amount: 0\r\n        })\r\n      } else {\r\n        selectedActivities.value.splice(index, 1)\r\n      }\r\n      calculateTotalReduction()\r\n    }\r\n\r\n    // 移除已选活动\r\n    const removeActivity = (activityId) => {\r\n      selectedActivities.value = selectedActivities.value.filter(\r\n        activity => activity.id !== activityId\r\n      )\r\n      calculateTotalReduction()\r\n    }\r\n\r\n    // 计算总减碳量\r\n    const calculateTotalReduction = () => {\r\n      totalReduction.value = selectedActivities.value.reduce((total, activity) => {\r\n        return total + (activity.amount * activity.factor)\r\n      }, 0)\r\n    }\r\n\r\n    // 检查是否可以保存\r\n    const canSave = computed(() => {\r\n      return selectedActivities.value.length > 0 &&\r\n        selectedActivities.value.every(activity => activity.amount > 0)\r\n    })\r\n\r\n    // 保存减碳记录\r\n    const saveReduction = async () => {\r\n      if (!canSave.value || isSaving.value) return\r\n      \r\n      isSaving.value = true\r\n      showSuccess.value = false\r\n      showError.value = false\r\n      \r\n      // 检查输入值的有效性\r\n      const invalidActivity = selectedActivities.value.find(activity => \r\n        !activity.amount || isNaN(activity.amount) || activity.amount <= 0\r\n      )\r\n      \r\n      if (invalidActivity) {\r\n        showError.value = true\r\n        errorMessage.value = `请为「${invalidActivity.name}」输入有效的数量`\r\n        isSaving.value = false\r\n        return\r\n      }\r\n\r\n      try {\r\n        // 准备提交的数据，确保reduction是数字类型\r\n        const activitiesData = selectedActivities.value.map(activity => ({\r\n          id: activity.id,\r\n          name: activity.name,\r\n          amount: parseFloat(activity.amount),\r\n          reduction: parseFloat((activity.amount * activity.factor).toFixed(2))\r\n        }))\r\n        \r\n        console.log('发送减碳数据:', activitiesData)\r\n        \r\n        // 检查用户token是否存在\r\n        const token = localStorage.getItem('token')\r\n        if (!token) {\r\n          showError.value = true\r\n          errorMessage.value = '未登录或会话已过期，请重新登录'\r\n          isSaving.value = false\r\n          return\r\n        }\r\n        \r\n        console.log('请求开始，准备发送POST请求到:', '/carbon/reduction')\r\n        \r\n        try {\r\n          // 获取配置好的axios实例\r\n          const api = getAPI()\r\n          \r\n          // 打印请求配置\r\n          console.log('API配置:', {\r\n            baseURL: api.defaults.baseURL,\r\n            timeout: api.defaults.timeout,\r\n            headers: api.defaults.headers\r\n          })\r\n          \r\n          // 发送请求\r\n          const response = await api.post('/carbon/reduction', {\r\n            activities: activitiesData\r\n          })\r\n          \r\n          console.log('请求成功，服务器响应:', response.data)\r\n          \r\n          if (response.data && response.data.success) {\r\n            // 清空已选活动\r\n            selectedActivities.value = []\r\n            // 重置总减碳量\r\n            totalReduction.value = 0\r\n            \r\n            // 显示成功消息\r\n            showSuccess.value = true\r\n            \r\n            // 通知父组件更新用户减碳总量\r\n            const newTotal = response.data.data.newTotalReduction || 0\r\n            console.log('新的减碳总量:', newTotal)\r\n            emit('reductionSaved', newTotal)\r\n            \r\n            // 延迟刷新\r\n            setTimeout(async () => {\r\n              try {\r\n                // 直接刷新当前页面的数据\r\n                await store.dispatch('updateUserCarbonReduction')\r\n                \r\n                // 同步更新排名系统\r\n                await store.dispatch('syncLeaderboardWithCarbonReduction')\r\n                console.log('已同步排名系统数据')\r\n              } catch (refreshError) {\r\n                console.error('刷新数据失败:', refreshError)\r\n              }\r\n            }, 1500)\r\n          } else {\r\n            showError.value = true\r\n            errorMessage.value = response.data?.error || '保存失败，请重试'\r\n            console.error('保存失败，响应中没有success标志:', response.data)\r\n          }\r\n        } catch (apiError) {\r\n          console.error('API调用失败:', apiError)\r\n          throw apiError\r\n        }\r\n      } catch (error) {\r\n        console.error('保存减碳记录失败:', error)\r\n        showError.value = true\r\n        \r\n        // 提取详细的错误信息\r\n        const serverError = error.response?.data?.error || error.response?.data?.message\r\n        const serverDetails = error.response?.data?.details\r\n        \r\n        if (serverError) {\r\n          errorMessage.value = serverDetails \r\n            ? `${serverError}: ${serverDetails}`\r\n            : serverError\r\n          console.error('服务器返回错误:', serverError, serverDetails)\r\n        } else if (error.request) {\r\n          // 请求发出但没有收到响应\r\n          errorMessage.value = '服务器无响应，请检查网络连接'\r\n          console.error('请求无响应:', error.request)\r\n        } else {\r\n          // 请求设置或发送前出错\r\n          errorMessage.value = '请求发送失败，请稍后重试'\r\n          console.error('请求发送错误:', error.message)\r\n        }\r\n      } finally {\r\n        isSaving.value = false\r\n      }\r\n    }\r\n\r\n    return {\r\n      categories,\r\n      activeCategory,\r\n      filteredActivities,\r\n      selectedActivities,\r\n      totalReduction,\r\n      showSuccess,\r\n      showError,\r\n      errorMessage,\r\n      isSaving,\r\n      canSave,\r\n      setActiveCategory,\r\n      isActivitySelected,\r\n      toggleActivity,\r\n      removeActivity,\r\n      calculateTotalReduction,\r\n      saveReduction\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.carbon-reduction-calculator {\r\n  max-width: 1200px;\r\n  margin: 0 auto;\r\n  padding: 0 20px;\r\n}\r\n\r\n.calculator-header {\r\n  text-align: center;\r\n  margin-bottom: 30px;\r\n  display: none; /* 隐藏重复的标题 */\r\n}\r\n\r\n.calculator-container {\r\n  display: flex;\r\n  gap: 20px;\r\n  background: #fff;\r\n  border-radius: 10px;\r\n  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);\r\n  padding: 20px;\r\n}\r\n\r\n.category-list {\r\n  width: 200px;\r\n  border-right: 1px solid #eee;\r\n  padding-right: 20px;\r\n}\r\n\r\n.category-item {\r\n  display: flex;\r\n  align-items: center;\r\n  padding: 12px 15px;\r\n  margin-bottom: 10px;\r\n  border-radius: 8px;\r\n  cursor: pointer;\r\n  transition: all 0.3s ease;\r\n}\r\n\r\n.category-item:hover {\r\n  background: #f5f5f5;\r\n}\r\n\r\n.category-item.active {\r\n  background: #e3f2fd;\r\n  color: #1976d2;\r\n}\r\n\r\n.category-item i {\r\n  margin-right: 10px;\r\n  font-size: 18px;\r\n}\r\n\r\n.activity-list {\r\n  flex: 1;\r\n  display: grid;\r\n  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));\r\n  gap: 15px;\r\n  padding: 0 20px;\r\n  max-height: 600px;\r\n  overflow-y: auto;\r\n}\r\n\r\n.activity-item {\r\n  background: #fff;\r\n  border: 1px solid #eee;\r\n  border-radius: 8px;\r\n  padding: 15px;\r\n  cursor: pointer;\r\n  transition: all 0.3s ease;\r\n}\r\n\r\n.activity-item:hover {\r\n  transform: translateY(-2px);\r\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.activity-item.selected {\r\n  border-color: #4caf50;\r\n  background: #f1f8e9;\r\n}\r\n\r\n.activity-icon {\r\n  width: 40px;\r\n  height: 40px;\r\n  background: #f5f5f5;\r\n  border-radius: 50%;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.activity-icon i {\r\n  font-size: 20px;\r\n  color: #666;\r\n}\r\n\r\n.activity-info h3 {\r\n  font-size: 16px;\r\n  margin-bottom: 5px;\r\n  color: #2c3e50;\r\n}\r\n\r\n.activity-info p {\r\n  font-size: 14px;\r\n  color: #666;\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.activity-factor {\r\n  font-size: 14px;\r\n  color: #666;\r\n}\r\n\r\n.factor-value {\r\n  color: #4caf50;\r\n  font-weight: bold;\r\n}\r\n\r\n.calculation-panel {\r\n  width: 300px;\r\n  border-left: 1px solid #eee;\r\n  padding-left: 20px;\r\n}\r\n\r\n.selected-activities {\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.selected-activities h3 {\r\n  font-size: 18px;\r\n  margin-bottom: 15px;\r\n  color: #2c3e50;\r\n}\r\n\r\n.no-activities {\r\n  text-align: center;\r\n  padding: 20px;\r\n  color: #999;\r\n}\r\n\r\n.no-activities i {\r\n  font-size: 24px;\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.activity-inputs {\r\n  max-height: 300px;\r\n  overflow-y: auto;\r\n}\r\n\r\n.activity-input {\r\n  background: #f5f5f5;\r\n  border-radius: 8px;\r\n  padding: 15px;\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.activity-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.remove-btn {\r\n  background: none;\r\n  border: none;\r\n  color: #999;\r\n  cursor: pointer;\r\n  padding: 5px;\r\n}\r\n\r\n.remove-btn:hover {\r\n  color: #f44336;\r\n}\r\n\r\n.input-group {\r\n  display: flex;\r\n  align-items: center;\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.input-group input {\r\n  flex: 1;\r\n  padding: 8px 12px;\r\n  border: 1px solid #ddd;\r\n  border-radius: 4px;\r\n  margin-right: 10px;\r\n}\r\n\r\n.unit {\r\n  color: #666;\r\n  font-size: 14px;\r\n}\r\n\r\n.reduction-amount {\r\n  font-size: 14px;\r\n  color: #4caf50;\r\n}\r\n\r\n.total-reduction {\r\n  background: #e8f5e9;\r\n  border-radius: 8px;\r\n  padding: 20px;\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.total-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.total-value {\r\n  font-size: 24px;\r\n  font-weight: bold;\r\n  color: #4caf50;\r\n}\r\n\r\n.tree-equivalent {\r\n  display: flex;\r\n  align-items: center;\r\n  color: #666;\r\n}\r\n\r\n.tree-equivalent i {\r\n  margin-right: 10px;\r\n  color: #4caf50;\r\n}\r\n\r\n.save-btn {\r\n  width: 100%;\r\n  padding: 12px;\r\n  background: #4caf50;\r\n  color: white;\r\n  border: none;\r\n  border-radius: 4px;\r\n  font-size: 16px;\r\n  cursor: pointer;\r\n  transition: background 0.3s ease;\r\n}\r\n\r\n.save-btn:hover {\r\n  background: #43a047;\r\n}\r\n\r\n.save-btn:disabled {\r\n  background: #cccccc;\r\n  cursor: not-allowed;\r\n}\r\n\r\n.save-btn i {\r\n  margin-right: 8px;\r\n}\r\n\r\n.success-message {\r\n  position: fixed;\r\n  top: 20px;\r\n  right: 20px;\r\n  color: white;\r\n  padding: 15px 25px;\r\n  border-radius: 4px;\r\n  display: flex;\r\n  align-items: flex-start;\r\n  animation: slideIn 0.3s ease;\r\n  z-index: 1000;\r\n  min-width: 300px;\r\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\r\n}\r\n\r\n.success-message.success {\r\n  background: #4caf50;\r\n}\r\n\r\n.success-message.error {\r\n  background: #f44336;\r\n}\r\n\r\n.success-message i {\r\n  margin-right: 15px;\r\n  font-size: 24px;\r\n}\r\n\r\n.message-content {\r\n  flex: 1;\r\n}\r\n\r\n.message-title {\r\n  font-weight: bold;\r\n  margin-bottom: 5px;\r\n}\r\n\r\n.message-detail {\r\n  font-size: 14px;\r\n  opacity: 0.9;\r\n}\r\n\r\n.close-message-btn {\r\n  background: none;\r\n  border: none;\r\n  color: white;\r\n  opacity: 0.7;\r\n  cursor: pointer;\r\n  font-size: 16px;\r\n  padding: 0;\r\n  margin-left: 10px;\r\n  transition: opacity 0.2s ease;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  width: 24px;\r\n  height: 24px;\r\n}\r\n\r\n.close-message-btn:hover {\r\n  opacity: 1;\r\n}\r\n\r\n@keyframes slideIn {\r\n  from {\r\n    transform: translateX(100%);\r\n    opacity: 0;\r\n  }\r\n  to {\r\n    transform: translateX(0);\r\n    opacity: 1;\r\n  }\r\n}\r\n\r\n/* 按钮加载中状态 */\r\n.fa-spinner {\r\n  animation: spin 1s infinite linear;\r\n}\r\n\r\n@keyframes spin {\r\n  from {\r\n    transform: rotate(0deg);\r\n  }\r\n  to {\r\n    transform: rotate(360deg);\r\n  }\r\n}\r\n</style> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}