{"ast":null,"code":"import \"core-js/modules/es.object.to-string.js\";\n// API 基础配置\nvar isDevelopment = process.env.NODE_ENV === 'development';\n\n// 根据环境设置基础 URL - 确保连接到正确的数据库服务器\nvar baseURL = isDevelopment ? 'http://localhost:5000/api' // 开发环境 - 连接本地服务器\n: 'https://api.ecopaw.com'; // 生产环境\n\n// API 端点\nexport var API_URLS = {\n  login: '/auth/login',\n  logout: '/auth/logout',\n  register: '/auth/register',\n  captcha: '/auth/captcha',\n  profile: '/user/profile',\n  calculator: '/carbon/calculate',\n  pet: '/pet',\n  achievements: '/achievement',\n  ranking: '/leaderboard',\n  testUsers: '/auth/test-users' // 添加测试用户查询接口\n};\n\n// axios 配置\nexport var axiosConfig = {\n  baseURL: baseURL,\n  timeout: 10000,\n  // 减少超时时间，提高用户体验\n  withCredentials: true,\n  headers: {\n    'Content-Type': 'application/json',\n    'Accept': 'application/json, image/svg+xml'\n  }\n};\n\n// 请求拦截器配置\nexport var requestInterceptor = function requestInterceptor(config) {\n  // 如果是获取验证码的请求，修改 headers\n  if (config.url === API_URLS.captcha) {\n    config.headers['Accept'] = 'image/svg+xml';\n    config.responseType = 'text';\n    return config;\n  }\n\n  // 为所有请求添加token\n  var token = localStorage.getItem('token');\n  if (token) {\n    config.headers.Authorization = \"Bearer \".concat(token);\n  }\n\n  // 添加调试信息\n  if (process.env.NODE_ENV === 'development') {\n    console.log('API请求:', config.url, config.method);\n  }\n  return config;\n};\n\n// 响应拦截器配置\nexport var responseInterceptor = {\n  success: function success(response) {\n    // 开发环境打印响应信息\n    if (process.env.NODE_ENV === 'development') {\n      console.log('API响应:', response.config.url, response.status);\n    }\n    return response;\n  },\n  error: function error(_error) {\n    console.error('API Error:', _error);\n    if (_error.response) {\n      // 处理401错误（未授权）\n      if (_error.response.status === 401) {\n        localStorage.removeItem('token');\n        localStorage.removeItem('username');\n        localStorage.removeItem('userId');\n        if (window.location.pathname !== '/login') {\n          window.location.href = '/login';\n        }\n      }\n    }\n    return Promise.reject(_error);\n  }\n};","map":{"version":3,"names":["isDevelopment","process","env","NODE_ENV","baseURL","API_URLS","login","logout","register","captcha","profile","calculator","pet","achievements","ranking","testUsers","axiosConfig","timeout","withCredentials","headers","requestInterceptor","config","url","responseType","token","localStorage","getItem","Authorization","concat","console","log","method","responseInterceptor","success","response","status","error","removeItem","window","location","pathname","href","Promise","reject"],"sources":["D:/computer_design/src/config/api.js"],"sourcesContent":["// API 基础配置\r\nconst isDevelopment = process.env.NODE_ENV === 'development';\r\n\r\n// 根据环境设置基础 URL - 确保连接到正确的数据库服务器\r\nconst baseURL = isDevelopment \r\n  ? 'http://localhost:5000/api'  // 开发环境 - 连接本地服务器\r\n  : 'https://api.ecopaw.com';    // 生产环境\r\n\r\n// API 端点\r\nexport const API_URLS = {\r\n  login: '/auth/login',\r\n  logout: '/auth/logout',\r\n  register: '/auth/register',\r\n  captcha: '/auth/captcha',\r\n  profile: '/user/profile',\r\n  calculator: '/carbon/calculate',\r\n  pet: '/pet',\r\n  achievements: '/achievement',\r\n  ranking: '/leaderboard',\r\n  testUsers: '/auth/test-users' // 添加测试用户查询接口\r\n};\r\n\r\n// axios 配置\r\nexport const axiosConfig = {\r\n  baseURL,\r\n  timeout: 10000, // 减少超时时间，提高用户体验\r\n  withCredentials: true,\r\n  headers: {\r\n    'Content-Type': 'application/json',\r\n    'Accept': 'application/json, image/svg+xml'\r\n  }\r\n};\r\n\r\n// 请求拦截器配置\r\nexport const requestInterceptor = (config) => {\r\n  // 如果是获取验证码的请求，修改 headers\r\n  if (config.url === API_URLS.captcha) {\r\n    config.headers['Accept'] = 'image/svg+xml';\r\n    config.responseType = 'text';\r\n    return config;\r\n  }\r\n  \r\n  // 为所有请求添加token\r\n  const token = localStorage.getItem('token');\r\n  if (token) {\r\n    config.headers.Authorization = `Bearer ${token}`;\r\n  }\r\n  \r\n  // 添加调试信息\r\n  if (process.env.NODE_ENV === 'development') {\r\n    console.log('API请求:', config.url, config.method);\r\n  }\r\n  \r\n  return config;\r\n};\r\n\r\n// 响应拦截器配置\r\nexport const responseInterceptor = {\r\n  success: (response) => {\r\n    // 开发环境打印响应信息\r\n    if (process.env.NODE_ENV === 'development') {\r\n      console.log('API响应:', response.config.url, response.status);\r\n    }\r\n    return response;\r\n  },\r\n  error: (error) => {\r\n    console.error('API Error:', error);\r\n    if (error.response) {\r\n      // 处理401错误（未授权）\r\n      if (error.response.status === 401) {\r\n        localStorage.removeItem('token');\r\n        localStorage.removeItem('username');\r\n        localStorage.removeItem('userId');\r\n        if (window.location.pathname !== '/login') {\r\n          window.location.href = '/login';\r\n        }\r\n      }\r\n    }\r\n    return Promise.reject(error);\r\n  }\r\n}; "],"mappings":";AAAA;AACA,IAAMA,aAAa,GAAGC,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK,aAAa;;AAE5D;AACA,IAAMC,OAAO,GAAGJ,aAAa,GACzB,2BAA2B,CAAE;AAAA,EAC7B,wBAAwB,CAAC,CAAI;;AAEjC;AACA,OAAO,IAAMK,QAAQ,GAAG;EACtBC,KAAK,EAAE,aAAa;EACpBC,MAAM,EAAE,cAAc;EACtBC,QAAQ,EAAE,gBAAgB;EAC1BC,OAAO,EAAE,eAAe;EACxBC,OAAO,EAAE,eAAe;EACxBC,UAAU,EAAE,mBAAmB;EAC/BC,GAAG,EAAE,MAAM;EACXC,YAAY,EAAE,cAAc;EAC5BC,OAAO,EAAE,cAAc;EACvBC,SAAS,EAAE,kBAAkB,CAAC;AAChC,CAAC;;AAED;AACA,OAAO,IAAMC,WAAW,GAAG;EACzBZ,OAAO,EAAPA,OAAO;EACPa,OAAO,EAAE,KAAK;EAAE;EAChBC,eAAe,EAAE,IAAI;EACrBC,OAAO,EAAE;IACP,cAAc,EAAE,kBAAkB;IAClC,QAAQ,EAAE;EACZ;AACF,CAAC;;AAED;AACA,OAAO,IAAMC,kBAAkB,GAAG,SAArBA,kBAAkBA,CAAIC,MAAM,EAAK;EAC5C;EACA,IAAIA,MAAM,CAACC,GAAG,KAAKjB,QAAQ,CAACI,OAAO,EAAE;IACnCY,MAAM,CAACF,OAAO,CAAC,QAAQ,CAAC,GAAG,eAAe;IAC1CE,MAAM,CAACE,YAAY,GAAG,MAAM;IAC5B,OAAOF,MAAM;EACf;;EAEA;EACA,IAAMG,KAAK,GAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;EAC3C,IAAIF,KAAK,EAAE;IACTH,MAAM,CAACF,OAAO,CAACQ,aAAa,aAAAC,MAAA,CAAaJ,KAAK,CAAE;EAClD;;EAEA;EACA,IAAIvB,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK,aAAa,EAAE;IAC1C0B,OAAO,CAACC,GAAG,CAAC,QAAQ,EAAET,MAAM,CAACC,GAAG,EAAED,MAAM,CAACU,MAAM,CAAC;EAClD;EAEA,OAAOV,MAAM;AACf,CAAC;;AAED;AACA,OAAO,IAAMW,mBAAmB,GAAG;EACjCC,OAAO,EAAE,SAATA,OAAOA,CAAGC,QAAQ,EAAK;IACrB;IACA,IAAIjC,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK,aAAa,EAAE;MAC1C0B,OAAO,CAACC,GAAG,CAAC,QAAQ,EAAEI,QAAQ,CAACb,MAAM,CAACC,GAAG,EAAEY,QAAQ,CAACC,MAAM,CAAC;IAC7D;IACA,OAAOD,QAAQ;EACjB,CAAC;EACDE,KAAK,EAAE,SAAPA,KAAKA,CAAGA,MAAK,EAAK;IAChBP,OAAO,CAACO,KAAK,CAAC,YAAY,EAAEA,MAAK,CAAC;IAClC,IAAIA,MAAK,CAACF,QAAQ,EAAE;MAClB;MACA,IAAIE,MAAK,CAACF,QAAQ,CAACC,MAAM,KAAK,GAAG,EAAE;QACjCV,YAAY,CAACY,UAAU,CAAC,OAAO,CAAC;QAChCZ,YAAY,CAACY,UAAU,CAAC,UAAU,CAAC;QACnCZ,YAAY,CAACY,UAAU,CAAC,QAAQ,CAAC;QACjC,IAAIC,MAAM,CAACC,QAAQ,CAACC,QAAQ,KAAK,QAAQ,EAAE;UACzCF,MAAM,CAACC,QAAQ,CAACE,IAAI,GAAG,QAAQ;QACjC;MACF;IACF;IACA,OAAOC,OAAO,CAACC,MAAM,CAACP,MAAK,CAAC;EAC9B;AACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}