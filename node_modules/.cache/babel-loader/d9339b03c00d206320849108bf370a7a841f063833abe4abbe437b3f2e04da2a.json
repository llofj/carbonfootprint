{"ast":null,"code":"import _toConsumableArray from \"D:/EcoPaw/carbonfootprint_\\u672C\\u5730\\u7248/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport \"core-js/modules/es.symbol.js\";\nimport \"core-js/modules/es.symbol.description.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.number.to-fixed.js\";\nimport { createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, normalizeClass as _normalizeClass, createElementVNode as _createElementVNode, toDisplayString as _toDisplayString, vModelText as _vModelText, withDirectives as _withDirectives, createTextVNode as _createTextVNode } from \"vue\";\nvar _hoisted_1 = {\n  \"class\": \"carbon-reduction-calculator\"\n};\nvar _hoisted_2 = {\n  \"class\": \"calculator-container\"\n};\nvar _hoisted_3 = {\n  \"class\": \"category-list\"\n};\nvar _hoisted_4 = [\"onClick\"];\nvar _hoisted_5 = {\n  \"class\": \"activity-list\"\n};\nvar _hoisted_6 = [\"onClick\"];\nvar _hoisted_7 = {\n  \"class\": \"activity-icon\"\n};\nvar _hoisted_8 = {\n  \"class\": \"activity-info\"\n};\nvar _hoisted_9 = {\n  \"class\": \"activity-factor\"\n};\nvar _hoisted_10 = {\n  \"class\": \"factor-value\"\n};\nvar _hoisted_11 = {\n  \"class\": \"calculation-panel\"\n};\nvar _hoisted_12 = {\n  \"class\": \"selected-activities\"\n};\nvar _hoisted_13 = {\n  key: 0,\n  \"class\": \"no-activities\"\n};\nvar _hoisted_14 = {\n  key: 1,\n  \"class\": \"activity-inputs\"\n};\nvar _hoisted_15 = {\n  \"class\": \"activity-header\"\n};\nvar _hoisted_16 = [\"onClick\"];\nvar _hoisted_17 = {\n  \"class\": \"input-group\"\n};\nvar _hoisted_18 = [\"onUpdate:modelValue\", \"placeholder\"];\nvar _hoisted_19 = {\n  \"class\": \"unit\"\n};\nvar _hoisted_20 = {\n  \"class\": \"reduction-amount\"\n};\nvar _hoisted_21 = {\n  \"class\": \"total-reduction\"\n};\nvar _hoisted_22 = {\n  \"class\": \"total-header\"\n};\nvar _hoisted_23 = {\n  \"class\": \"total-value\"\n};\nvar _hoisted_24 = {\n  \"class\": \"tree-equivalent\"\n};\nvar _hoisted_25 = [\"disabled\"];\nvar _hoisted_26 = {\n  key: 0,\n  \"class\": \"fas fa-save\"\n};\nvar _hoisted_27 = {\n  key: 1,\n  \"class\": \"fas fa-spinner fa-spin\"\n};\nvar _hoisted_28 = {\n  key: 0,\n  \"class\": \"success-message success\"\n};\nvar _hoisted_29 = {\n  key: 1,\n  \"class\": \"success-message error\"\n};\nvar _hoisted_30 = {\n  \"class\": \"message-content\"\n};\nvar _hoisted_31 = {\n  \"class\": \"message-detail\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_createCommentVNode(\" 左侧分类列表 \"), _createElementVNode(\"div\", _hoisted_3, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.categories, function (category) {\n    return _openBlock(), _createElementBlock(\"div\", {\n      key: category.id,\n      \"class\": _normalizeClass([\"category-item\", {\n        active: $setup.activeCategory === category.id\n      }]),\n      onClick: function onClick($event) {\n        return $setup.setActiveCategory(category.id);\n      }\n    }, [_createElementVNode(\"i\", {\n      \"class\": _normalizeClass(category.icon)\n    }, null, 2 /* CLASS */), _createElementVNode(\"span\", null, _toDisplayString(category.name), 1 /* TEXT */)], 10 /* CLASS, PROPS */, _hoisted_4);\n  }), 128 /* KEYED_FRAGMENT */))]), _createCommentVNode(\" 中间活动列表 \"), _createElementVNode(\"div\", _hoisted_5, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.filteredActivities, function (activity) {\n    return _openBlock(), _createElementBlock(\"div\", {\n      key: activity.id,\n      \"class\": _normalizeClass([\"activity-item\", {\n        selected: $setup.isActivitySelected(activity.id)\n      }]),\n      onClick: function onClick($event) {\n        return $setup.toggleActivity(activity);\n      }\n    }, [_createElementVNode(\"div\", _hoisted_7, [_createElementVNode(\"i\", {\n      \"class\": _normalizeClass(activity.icon)\n    }, null, 2 /* CLASS */)]), _createElementVNode(\"div\", _hoisted_8, [_createElementVNode(\"h3\", null, _toDisplayString(activity.name), 1 /* TEXT */), _createElementVNode(\"p\", null, _toDisplayString(activity.description), 1 /* TEXT */), _createElementVNode(\"div\", _hoisted_9, [_cache[4] || (_cache[4] = _createElementVNode(\"span\", null, \"减碳系数：\", -1 /* HOISTED */)), _createElementVNode(\"span\", _hoisted_10, _toDisplayString(activity.factor) + \" kgCO₂e/\" + _toDisplayString(activity.unit), 1 /* TEXT */)])])], 10 /* CLASS, PROPS */, _hoisted_6);\n  }), 128 /* KEYED_FRAGMENT */))]), _createCommentVNode(\" 右侧计算面板 \"), _createElementVNode(\"div\", _hoisted_11, [_createElementVNode(\"div\", _hoisted_12, [_cache[7] || (_cache[7] = _createElementVNode(\"h3\", null, \"已选减碳活动\", -1 /* HOISTED */)), $setup.selectedActivities.length === 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_13, _cache[5] || (_cache[5] = [_createElementVNode(\"i\", {\n    \"class\": \"fas fa-info-circle\"\n  }, null, -1 /* HOISTED */), _createElementVNode(\"p\", null, \"请从左侧选择减碳活动\", -1 /* HOISTED */)]))) : (_openBlock(), _createElementBlock(\"div\", _hoisted_14, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.selectedActivities, function (activity) {\n    return _openBlock(), _createElementBlock(\"div\", {\n      key: activity.id,\n      \"class\": \"activity-input\"\n    }, [_createElementVNode(\"div\", _hoisted_15, [_createElementVNode(\"span\", null, _toDisplayString(activity.name), 1 /* TEXT */), _createElementVNode(\"button\", {\n      \"class\": \"remove-btn\",\n      onClick: function onClick($event) {\n        return $setup.removeActivity(activity.id);\n      }\n    }, _toConsumableArray(_cache[6] || (_cache[6] = [_createElementVNode(\"i\", {\n      \"class\": \"fas fa-times\"\n    }, null, -1 /* HOISTED */)])), 8 /* PROPS */, _hoisted_16)]), _createElementVNode(\"div\", _hoisted_17, [_withDirectives(_createElementVNode(\"input\", {\n      type: \"number\",\n      \"onUpdate:modelValue\": function onUpdateModelValue($event) {\n        return activity.amount = $event;\n      },\n      placeholder: '输入' + activity.unit,\n      min: \"0\",\n      onInput: _cache[0] || (_cache[0] = function () {\n        return $setup.calculateTotalReduction && $setup.calculateTotalReduction.apply($setup, arguments);\n      })\n    }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_18), [[_vModelText, activity.amount]]), _createElementVNode(\"span\", _hoisted_19, _toDisplayString(activity.unit), 1 /* TEXT */)]), _createElementVNode(\"div\", _hoisted_20, \" 减碳量：\" + _toDisplayString((activity.amount * activity.factor).toFixed(2)) + \" kgCO₂e \", 1 /* TEXT */)]);\n  }), 128 /* KEYED_FRAGMENT */))]))]), _createElementVNode(\"div\", _hoisted_21, [_createElementVNode(\"div\", _hoisted_22, [_cache[8] || (_cache[8] = _createElementVNode(\"h3\", null, \"总减碳量\", -1 /* HOISTED */)), _createElementVNode(\"span\", _hoisted_23, _toDisplayString($setup.totalReduction.toFixed(2)) + \" kgCO₂e\", 1 /* TEXT */)]), _createElementVNode(\"div\", _hoisted_24, [_cache[9] || (_cache[9] = _createElementVNode(\"i\", {\n    \"class\": \"fas fa-tree\"\n  }, null, -1 /* HOISTED */)), _createElementVNode(\"span\", null, \"相当于种植了 \" + _toDisplayString(($setup.totalReduction / 18).toFixed(1)) + \" 棵树\", 1 /* TEXT */)])]), _createElementVNode(\"button\", {\n    \"class\": \"save-btn\",\n    disabled: !$setup.canSave || $setup.isSaving,\n    onClick: _cache[1] || (_cache[1] = function () {\n      return $setup.saveReduction && $setup.saveReduction.apply($setup, arguments);\n    })\n  }, [!$setup.isSaving ? (_openBlock(), _createElementBlock(\"i\", _hoisted_26)) : (_openBlock(), _createElementBlock(\"i\", _hoisted_27)), _createTextVNode(\" \" + _toDisplayString($setup.isSaving ? '保存中...' : '保存减碳记录'), 1 /* TEXT */)], 8 /* PROPS */, _hoisted_25)])]), _createCommentVNode(\" 保存成功提示 \"), $setup.showSuccess ? (_openBlock(), _createElementBlock(\"div\", _hoisted_28, [_cache[11] || (_cache[11] = _createElementVNode(\"i\", {\n    \"class\": \"fas fa-check-circle\"\n  }, null, -1 /* HOISTED */)), _cache[12] || (_cache[12] = _createElementVNode(\"div\", {\n    \"class\": \"message-content\"\n  }, [_createElementVNode(\"div\", {\n    \"class\": \"message-title\"\n  }, \"减碳记录保存成功！\")], -1 /* HOISTED */)), _createElementVNode(\"button\", {\n    \"class\": \"close-message-btn\",\n    onClick: _cache[2] || (_cache[2] = function ($event) {\n      return $setup.showSuccess = false;\n    })\n  }, _cache[10] || (_cache[10] = [_createElementVNode(\"i\", {\n    \"class\": \"fas fa-times\"\n  }, null, -1 /* HOISTED */)]))])) : _createCommentVNode(\"v-if\", true), _createCommentVNode(\" 保存失败提示 \"), $setup.showError ? (_openBlock(), _createElementBlock(\"div\", _hoisted_29, [_cache[15] || (_cache[15] = _createElementVNode(\"i\", {\n    \"class\": \"fas fa-exclamation-circle\"\n  }, null, -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_30, [_cache[13] || (_cache[13] = _createElementVNode(\"div\", {\n    \"class\": \"message-title\"\n  }, \"保存失败\", -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_31, _toDisplayString($setup.errorMessage), 1 /* TEXT */)]), _createElementVNode(\"button\", {\n    \"class\": \"close-message-btn\",\n    onClick: _cache[3] || (_cache[3] = function ($event) {\n      return $setup.showError = false;\n    })\n  }, _cache[14] || (_cache[14] = [_createElementVNode(\"i\", {\n    \"class\": \"fas fa-times\"\n  }, null, -1 /* HOISTED */)]))])) : _createCommentVNode(\"v-if\", true)]);\n}","map":{"version":3,"names":["key","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_createCommentVNode","_hoisted_3","_Fragment","_renderList","$setup","categories","category","id","_normalizeClass","active","activeCategory","onClick","$event","setActiveCategory","icon","_toDisplayString","name","_hoisted_4","_hoisted_5","filteredActivities","activity","selected","isActivitySelected","toggleActivity","_hoisted_7","_hoisted_8","description","_hoisted_9","_hoisted_10","factor","unit","_hoisted_6","_hoisted_11","_hoisted_12","selectedActivities","length","_hoisted_13","_cache","_hoisted_14","_hoisted_15","removeActivity","_hoisted_16","_hoisted_17","type","onUpdateModelValue","amount","placeholder","min","onInput","calculateTotalReduction","apply","arguments","_hoisted_18","_hoisted_19","_hoisted_20","toFixed","_hoisted_21","_hoisted_22","_hoisted_23","totalReduction","_hoisted_24","disabled","canSave","isSaving","saveReduction","_hoisted_26","_hoisted_27","_createTextVNode","_hoisted_25","showSuccess","_hoisted_28","showError","_hoisted_29","_hoisted_30","_hoisted_31","errorMessage"],"sources":["D:\\EcoPaw\\carbonfootprint_本地版\\src\\components\\CarbonReductionCalculator.vue"],"sourcesContent":["<template>\n  <div class=\"carbon-reduction-calculator\">\n    <div class=\"calculator-container\">\n      <!-- 左侧分类列表 -->\n      <div class=\"category-list\">\n        <div\n          v-for=\"category in categories\"\n          :key=\"category.id\"\n          class=\"category-item\"\n          :class=\"{ active: activeCategory === category.id }\"\n          @click=\"setActiveCategory(category.id)\"\n        >\n          <i :class=\"category.icon\"></i>\n          <span>{{ category.name }}</span>\n        </div>\n      </div>\n\n      <!-- 中间活动列表 -->\n      <div class=\"activity-list\">\n        <div\n          v-for=\"activity in filteredActivities\"\n          :key=\"activity.id\"\n          class=\"activity-item\"\n          :class=\"{ selected: isActivitySelected(activity.id) }\"\n          @click=\"toggleActivity(activity)\"\n        >\n          <div class=\"activity-icon\">\n            <i :class=\"activity.icon\"></i>\n          </div>\n          <div class=\"activity-info\">\n            <h3>{{ activity.name }}</h3>\n            <p>{{ activity.description }}</p>\n            <div class=\"activity-factor\">\n              <span>减碳系数：</span>\n              <span class=\"factor-value\">{{ activity.factor }} kgCO₂e/{{ activity.unit }}</span>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <!-- 右侧计算面板 -->\n      <div class=\"calculation-panel\">\n        <div class=\"selected-activities\">\n          <h3>已选减碳活动</h3>\n          <div v-if=\"selectedActivities.length === 0\" class=\"no-activities\">\n            <i class=\"fas fa-info-circle\"></i>\n            <p>请从左侧选择减碳活动</p>\n          </div>\n          <div v-else class=\"activity-inputs\">\n            <div v-for=\"activity in selectedActivities\" :key=\"activity.id\" class=\"activity-input\">\n              <div class=\"activity-header\">\n                <span>{{ activity.name }}</span>\n                <button class=\"remove-btn\" @click=\"removeActivity(activity.id)\">\n                  <i class=\"fas fa-times\"></i>\n                </button>\n              </div>\n              <div class=\"input-group\">\n                <input\n                  type=\"number\"\n                  v-model=\"activity.amount\"\n                  :placeholder=\"'输入' + activity.unit\"\n                  min=\"0\"\n                  @input=\"calculateTotalReduction\"\n                />\n                <span class=\"unit\">{{ activity.unit }}</span>\n              </div>\n              <div class=\"reduction-amount\">\n                减碳量：{{ (activity.amount * activity.factor).toFixed(2) }} kgCO₂e\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div class=\"total-reduction\">\n          <div class=\"total-header\">\n            <h3>总减碳量</h3>\n            <span class=\"total-value\">{{ totalReduction.toFixed(2) }} kgCO₂e</span>\n          </div>\n          <div class=\"tree-equivalent\">\n            <i class=\"fas fa-tree\"></i>\n            <span>相当于种植了 {{ (totalReduction / 18).toFixed(1) }} 棵树</span>\n          </div>\n        </div>\n\n        <button\n          class=\"save-btn\"\n          :disabled=\"!canSave || isSaving\"\n          @click=\"saveReduction\"\n        >\n          <i class=\"fas fa-save\" v-if=\"!isSaving\"></i>\n          <i class=\"fas fa-spinner fa-spin\" v-else></i>\n          {{ isSaving ? '保存中...' : '保存减碳记录' }}\n        </button>\n      </div>\n    </div>\n\n    <!-- 保存成功提示 -->\n    <div v-if=\"showSuccess\" class=\"success-message success\">\n      <i class=\"fas fa-check-circle\"></i>\n      <div class=\"message-content\">\n        <div class=\"message-title\">减碳记录保存成功！</div>\n      </div>\n      <button class=\"close-message-btn\" @click=\"showSuccess = false\">\n        <i class=\"fas fa-times\"></i>\n      </button>\n    </div>\n    \n    <!-- 保存失败提示 -->\n    <div v-if=\"showError\" class=\"success-message error\">\n      <i class=\"fas fa-exclamation-circle\"></i>\n      <div class=\"message-content\">\n        <div class=\"message-title\">保存失败</div>\n        <div class=\"message-detail\">{{ errorMessage }}</div>\n      </div>\n      <button class=\"close-message-btn\" @click=\"showError = false\">\n        <i class=\"fas fa-times\"></i>\n      </button>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { ref, computed } from 'vue'\nimport { useStore } from 'vuex'\nimport { useRouter } from 'vue-router'\nimport { getAPI } from '@/config/api'\n\nexport default {\n  name: 'CarbonReductionCalculator',\n  emits: ['reductionSaved'],\n  setup(props, { emit }) {\n    const store = useStore()\n    const router = useRouter()\n    const showSuccess = ref(false)\n    const showError = ref(false)\n    const errorMessage = ref('')\n    const isSaving = ref(false)\n\n    // 减碳活动分类\n    const categories = [\n      { id: 'transport', name: '交通出行', icon: 'fas fa-car' },\n      { id: 'energy', name: '能源使用', icon: 'fas fa-bolt' },\n      { id: 'food', name: '饮食选择', icon: 'fas fa-utensils' },\n      { id: 'waste', name: '垃圾处理', icon: 'fas fa-trash' },\n      { id: 'lifestyle', name: '生活方式', icon: 'fas fa-heart' }\n    ]\n\n    // 减碳活动列表\n    const activities = [\n      {\n        id: 'bike',\n        category: 'transport',\n        name: '骑自行车出行',\n        description: '使用自行车代替机动车出行',\n        icon: 'fas fa-bicycle',\n        factor: 0.22,\n        unit: '公里'\n      },\n      {\n        id: 'public_transport',\n        category: 'transport',\n        name: '乘坐公共交通',\n        description: '使用公交、地铁等公共交通工具',\n        icon: 'fas fa-bus',\n        factor: 0.12,\n        unit: '公里'\n      },\n      {\n        id: 'walk',\n        category: 'transport',\n        name: '步行出行',\n        description: '选择步行代替其他交通方式',\n        icon: 'fas fa-walking',\n        factor: 0.25,\n        unit: '公里'\n      },\n      {\n        id: 'led_light',\n        category: 'energy',\n        name: '使用LED灯',\n        description: '使用LED节能灯泡',\n        icon: 'fas fa-lightbulb',\n        factor: 0.05,\n        unit: '小时'\n      },\n      {\n        id: 'solar_panel',\n        category: 'energy',\n        name: '使用太阳能',\n        description: '使用太阳能热水器或发电',\n        icon: 'fas fa-solar-panel',\n        factor: 0.7,\n        unit: '千瓦时'\n      },\n      {\n        id: 'vegetarian',\n        category: 'food',\n        name: '素食饮食',\n        description: '选择素食代替肉类',\n        icon: 'fas fa-leaf',\n        factor: 2.5,\n        unit: '餐'\n      },\n      {\n        id: 'local_food',\n        category: 'food',\n        name: '本地食材',\n        description: '选择本地生产的食材',\n        icon: 'fas fa-store',\n        factor: 0.4,\n        unit: '公斤'\n      },\n      {\n        id: 'recycle',\n        category: 'waste',\n        name: '垃圾分类回收',\n        description: '正确分类和回收垃圾',\n        icon: 'fas fa-recycle',\n        factor: 0.5,\n        unit: '公斤'\n      },\n      {\n        id: 'compost',\n        category: 'waste',\n        name: '厨余堆肥',\n        description: '将厨余垃圾进行堆肥处理',\n        icon: 'fas fa-seedling',\n        factor: 0.6,\n        unit: '公斤'\n      },\n      {\n        id: 'reusable_bag',\n        category: 'lifestyle',\n        name: '使用环保袋',\n        description: '使用可重复使用的购物袋',\n        icon: 'fas fa-shopping-bag',\n        factor: 0.05,\n        unit: '次'\n      },\n      {\n        id: 'reusable_bottle',\n        category: 'lifestyle',\n        name: '使用环保水杯',\n        description: '使用可重复使用的水杯',\n        icon: 'fas fa-glass-whiskey',\n        factor: 0.15,\n        unit: '次'\n      }\n    ]\n\n    const activeCategory = ref('transport')\n    const selectedActivities = ref([])\n    const totalReduction = ref(0)\n\n    // 根据当前分类筛选活动\n    const filteredActivities = computed(() => {\n      return activities.filter(activity => activity.category === activeCategory.value)\n    })\n\n    // 设置当前活动分类\n    const setActiveCategory = (categoryId) => {\n      activeCategory.value = categoryId\n    }\n\n    // 检查活动是否已选择\n    const isActivitySelected = (activityId) => {\n      return selectedActivities.value.some(activity => activity.id === activityId)\n    }\n\n    // 切换活动选择状态\n    const toggleActivity = (activity) => {\n      const index = selectedActivities.value.findIndex(item => item.id === activity.id)\n      if (index === -1) {\n        selectedActivities.value.push({\n          ...activity,\n          amount: 0\n        })\n      } else {\n        selectedActivities.value.splice(index, 1)\n      }\n      calculateTotalReduction()\n    }\n\n    // 移除已选活动\n    const removeActivity = (activityId) => {\n      selectedActivities.value = selectedActivities.value.filter(\n        activity => activity.id !== activityId\n      )\n      calculateTotalReduction()\n    }\n\n    // 计算总减碳量\n    const calculateTotalReduction = () => {\n      totalReduction.value = selectedActivities.value.reduce((total, activity) => {\n        return total + (activity.amount * activity.factor)\n      }, 0)\n    }\n\n    // 检查是否可以保存\n    const canSave = computed(() => {\n      return selectedActivities.value.length > 0 &&\n        selectedActivities.value.every(activity => activity.amount > 0)\n    })\n\n    // 保存减碳记录\n    const saveReduction = async () => {\n      if (!canSave.value || isSaving.value) return\n      \n      isSaving.value = true\n      showSuccess.value = false\n      showError.value = false\n      \n      // 检查输入值的有效性\n      const invalidActivity = selectedActivities.value.find(activity => \n        !activity.amount || isNaN(activity.amount) || activity.amount <= 0\n      )\n      \n      if (invalidActivity) {\n        showError.value = true\n        errorMessage.value = `请为「${invalidActivity.name}」输入有效的数量`\n        isSaving.value = false\n        return\n      }\n\n      try {\n        // 准备提交的数据，确保reduction是数字类型\n        const activitiesData = selectedActivities.value.map(activity => ({\n          id: activity.id,\n          name: activity.name,\n          amount: parseFloat(activity.amount),\n          reduction: parseFloat((activity.amount * activity.factor).toFixed(2))\n        }))\n        \n        console.log('发送减碳数据:', activitiesData)\n        \n        // 检查用户token是否存在\n        const token = localStorage.getItem('token')\n        if (!token) {\n          showError.value = true\n          errorMessage.value = '您需要登录才能保存减碳数据。未登录用户可以计算减碳量，但无法保存记录。'\n          // 移除登录重定向，只提示用户\n          setTimeout(() => {\n            alert('需要登录才能保存减碳记录。您可以继续使用计算器，但数据不会被保存。')\n            // 去掉登录重定向\n            // if (confirm('需要登录才能保存减碳记录。是否前往登录页面？')) {\n            //   router.push('/login')\n            // }\n          }, 500)\n          isSaving.value = false\n          return\n        }\n        \n        console.log('请求开始，准备发送POST请求到:', '/carbon/reduction')\n        \n        try {\n          // 获取配置好的axios实例\n          const api = getAPI()\n          \n          // 打印请求配置\n          console.log('API配置:', {\n            baseURL: api.defaults.baseURL,\n            timeout: api.defaults.timeout,\n            headers: api.defaults.headers\n          })\n          \n          // 发送请求\n          const response = await api.post('/carbon/reduction', {\n            activities: activitiesData\n          })\n          \n          console.log('请求成功，服务器响应:', response.data)\n          \n          if (response.data && response.data.success) {\n            // 清空已选活动\n            selectedActivities.value = []\n            // 重置总减碳量\n            totalReduction.value = 0\n            \n            // 显示成功消息\n            showSuccess.value = true\n            \n            // 通知父组件更新用户减碳总量\n            const newTotal = response.data.data.newTotalReduction || 0\n            console.log('新的减碳总量:', newTotal)\n            emit('reductionSaved', newTotal)\n            \n            // 延迟刷新\n            setTimeout(async () => {\n              try {\n                // 直接刷新当前页面的数据\n                await store.dispatch('updateUserCarbonReduction')\n                \n                // 同步更新排名系统\n                await store.dispatch('syncLeaderboardWithCarbonReduction')\n                console.log('已同步排名系统数据')\n              } catch (refreshError) {\n                console.error('刷新数据失败:', refreshError)\n              }\n            }, 1500)\n          } else {\n            showError.value = true\n            errorMessage.value = response.data?.error || '保存失败，请重试'\n            console.error('保存失败，响应中没有success标志:', response.data)\n          }\n        } catch (apiError) {\n          console.error('API调用失败:', apiError)\n          throw apiError\n        }\n      } catch (error) {\n        console.error('保存减碳记录失败:', error)\n        showError.value = true\n        \n        // 提取详细的错误信息\n        const serverError = error.response?.data?.error || error.response?.data?.message\n        const serverDetails = error.response?.data?.details\n        \n        if (serverError) {\n          errorMessage.value = serverDetails \n            ? `${serverError}: ${serverDetails}`\n            : serverError\n          console.error('服务器返回错误:', serverError, serverDetails)\n        } else if (error.request) {\n          // 请求发出但没有收到响应\n          errorMessage.value = '服务器无响应，请检查网络连接'\n          console.error('请求无响应:', error.request)\n        } else {\n          // 请求设置或发送前出错\n          errorMessage.value = '请求发送失败，请稍后重试'\n          console.error('请求发送错误:', error.message)\n        }\n      } finally {\n        isSaving.value = false\n      }\n    }\n\n    return {\n      categories,\n      activeCategory,\n      filteredActivities,\n      selectedActivities,\n      totalReduction,\n      showSuccess,\n      showError,\n      errorMessage,\n      isSaving,\n      canSave,\n      setActiveCategory,\n      isActivitySelected,\n      toggleActivity,\n      removeActivity,\n      calculateTotalReduction,\n      saveReduction\n    }\n  }\n}\n</script>\n\n<style scoped>\n.carbon-reduction-calculator {\n  max-width: 1200px;\n  margin: 0 auto;\n  padding: 0 20px;\n}\n\n.calculator-header {\n  text-align: center;\n  margin-bottom: 30px;\n  display: none; /* 隐藏重复的标题 */\n}\n\n.calculator-container {\n  display: flex;\n  gap: 20px;\n  background: #fff;\n  border-radius: 10px;\n  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);\n  padding: 20px;\n}\n\n.category-list {\n  width: 200px;\n  border-right: 1px solid #eee;\n  padding-right: 20px;\n}\n\n.category-item {\n  display: flex;\n  align-items: center;\n  padding: 12px 15px;\n  margin-bottom: 10px;\n  border-radius: 8px;\n  cursor: pointer;\n  transition: all 0.3s ease;\n}\n\n.category-item:hover {\n  background: #f5f5f5;\n}\n\n.category-item.active {\n  background: #e3f2fd;\n  color: #1976d2;\n}\n\n.category-item i {\n  margin-right: 10px;\n  font-size: 18px;\n}\n\n.activity-list {\n  flex: 1;\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));\n  gap: 15px;\n  padding: 0 20px;\n  max-height: 600px;\n  overflow-y: auto;\n}\n\n.activity-item {\n  background: #fff;\n  border: 1px solid #eee;\n  border-radius: 8px;\n  padding: 15px;\n  cursor: pointer;\n  transition: all 0.3s ease;\n}\n\n.activity-item:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n}\n\n.activity-item.selected {\n  border-color: #4caf50;\n  background: #f1f8e9;\n}\n\n.activity-icon {\n  width: 40px;\n  height: 40px;\n  background: #f5f5f5;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-bottom: 10px;\n}\n\n.activity-icon i {\n  font-size: 20px;\n  color: #666;\n}\n\n.activity-info h3 {\n  font-size: 16px;\n  margin-bottom: 5px;\n  color: #2c3e50;\n}\n\n.activity-info p {\n  font-size: 14px;\n  color: #666;\n  margin-bottom: 10px;\n}\n\n.activity-factor {\n  font-size: 14px;\n  color: #666;\n}\n\n.factor-value {\n  color: #4caf50;\n  font-weight: bold;\n}\n\n.calculation-panel {\n  width: 300px;\n  border-left: 1px solid #eee;\n  padding-left: 20px;\n}\n\n.selected-activities {\n  margin-bottom: 20px;\n}\n\n.selected-activities h3 {\n  font-size: 18px;\n  margin-bottom: 15px;\n  color: #2c3e50;\n}\n\n.no-activities {\n  text-align: center;\n  padding: 20px;\n  color: #999;\n}\n\n.no-activities i {\n  font-size: 24px;\n  margin-bottom: 10px;\n}\n\n.activity-inputs {\n  max-height: 300px;\n  overflow-y: auto;\n}\n\n.activity-input {\n  background: #f5f5f5;\n  border-radius: 8px;\n  padding: 15px;\n  margin-bottom: 10px;\n}\n\n.activity-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 10px;\n}\n\n.remove-btn {\n  background: none;\n  border: none;\n  color: #999;\n  cursor: pointer;\n  padding: 5px;\n}\n\n.remove-btn:hover {\n  color: #f44336;\n}\n\n.input-group {\n  display: flex;\n  align-items: center;\n  margin-bottom: 10px;\n}\n\n.input-group input {\n  flex: 1;\n  padding: 8px 12px;\n  border: 1px solid #ddd;\n  border-radius: 4px;\n  margin-right: 10px;\n}\n\n.unit {\n  color: #666;\n  font-size: 14px;\n}\n\n.reduction-amount {\n  font-size: 14px;\n  color: #4caf50;\n}\n\n.total-reduction {\n  background: #e8f5e9;\n  border-radius: 8px;\n  padding: 20px;\n  margin-bottom: 20px;\n}\n\n.total-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 10px;\n}\n\n.total-value {\n  font-size: 24px;\n  font-weight: bold;\n  color: #4caf50;\n}\n\n.tree-equivalent {\n  display: flex;\n  align-items: center;\n  color: #666;\n}\n\n.tree-equivalent i {\n  margin-right: 10px;\n  color: #4caf50;\n}\n\n.save-btn {\n  width: 100%;\n  padding: 12px;\n  background: #4caf50;\n  color: white;\n  border: none;\n  border-radius: 4px;\n  font-size: 16px;\n  cursor: pointer;\n  transition: background 0.3s ease;\n}\n\n.save-btn:hover {\n  background: #43a047;\n}\n\n.save-btn:disabled {\n  background: #cccccc;\n  cursor: not-allowed;\n}\n\n.save-btn i {\n  margin-right: 8px;\n}\n\n.success-message {\n  position: fixed;\n  top: 20px;\n  right: 20px;\n  color: white;\n  padding: 15px 25px;\n  border-radius: 4px;\n  display: flex;\n  align-items: flex-start;\n  animation: slideIn 0.3s ease;\n  z-index: 1000;\n  min-width: 300px;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n}\n\n.success-message.success {\n  background: #4caf50;\n}\n\n.success-message.error {\n  background: #f44336;\n}\n\n.success-message i {\n  margin-right: 15px;\n  font-size: 24px;\n}\n\n.message-content {\n  flex: 1;\n}\n\n.message-title {\n  font-weight: bold;\n  margin-bottom: 5px;\n}\n\n.message-detail {\n  font-size: 14px;\n  opacity: 0.9;\n}\n\n.close-message-btn {\n  background: none;\n  border: none;\n  color: white;\n  opacity: 0.7;\n  cursor: pointer;\n  font-size: 16px;\n  padding: 0;\n  margin-left: 10px;\n  transition: opacity 0.2s ease;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 24px;\n  height: 24px;\n}\n\n.close-message-btn:hover {\n  opacity: 1;\n}\n\n@keyframes slideIn {\n  from {\n    transform: translateX(100%);\n    opacity: 0;\n  }\n  to {\n    transform: translateX(0);\n    opacity: 1;\n  }\n}\n\n/* 按钮加载中状态 */\n.fa-spinner {\n  animation: spin 1s infinite linear;\n}\n\n@keyframes spin {\n  from {\n    transform: rotate(0deg);\n  }\n  to {\n    transform: rotate(360deg);\n  }\n}\n</style> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}