"use strict";(self["webpackChunkecopaw"]=self["webpackChunkecopaw"]||[]).push([[565],{3565:(e,r,a)=>{a.r(r),a.d(r,{default:()=>S});var n=a(6768),t={class:"content"};function o(e,r,a,o,l,s){var u=(0,n.g2)("Navbar"),d=(0,n.g2)("Leaderboard");return(0,n.uX)(),(0,n.CE)("div",null,[(0,n.bF)(u),(0,n.Lk)("div",t,[(0,n.bF)(d)])])}var l=a(354),s=(a(9868),a(5130)),u=a(4232),d={class:"leaderboard-page"},i={class:"leaderboard-header"},c={class:"update-section"},k={class:"filter-section"},v={key:0,class:"my-rank"},h={class:"rank-badge"},p={class:"rank-details"},b={class:"rank-username"},f={class:"rank-reduction"},L={class:"leaderboard-container"},g={class:"rank-column"},m={class:"user-column"},w={class:"reduction-column"},C={key:0,class:"no-data"};function x(e,r,a,t,o,l){return(0,n.uX)(),(0,n.CE)("div",d,[r[6]||(r[6]=(0,n.Lk)("h2",null,"碳减排排行榜",-1)),(0,n.Lk)("div",i,[(0,n.Lk)("div",c,[(0,n.Lk)("button",{onClick:r[0]||(r[0]=function(){return l.updateLeaderboard&&l.updateLeaderboard.apply(l,arguments)}),class:"update-btn"},r[3]||(r[3]=[(0,n.Lk)("i",{class:"fas fa-sync-alt"},null,-1),(0,n.eW)(" 更新排名 ")]))]),(0,n.Lk)("div",k,[(0,n.bo)((0,n.Lk)("select",{"onUpdate:modelValue":r[1]||(r[1]=function(e){return o.limit=e}),onChange:r[2]||(r[2]=function(){return l.loadLeaderboard&&l.loadLeaderboard.apply(l,arguments)})},r[4]||(r[4]=[(0,n.Lk)("option",{value:5},"显示前5名",-1),(0,n.Lk)("option",{value:10},"显示前10名",-1),(0,n.Lk)("option",{value:20},"显示前20名",-1)]),544),[[s.u1,o.limit]])])]),o.userRank?((0,n.uX)(),(0,n.CE)("div",v,[(0,n.Lk)("div",h,"#"+(0,u.v_)(o.userRank.rank),1),(0,n.Lk)("div",p,[(0,n.Lk)("div",b,(0,u.v_)(o.username),1),(0,n.Lk)("div",f,"减排量: "+(0,u.v_)(o.userRank.carbon_reduction.toFixed(1))+" kg CO₂",1)])])):(0,n.Q3)("",!0),(0,n.Lk)("div",L,[r[5]||(r[5]=(0,n.Lk)("div",{class:"leaderboard-row header"},[(0,n.Lk)("div",{class:"rank-column"},"排名"),(0,n.Lk)("div",{class:"user-column"},"用户"),(0,n.Lk)("div",{class:"reduction-column"},"减排量 (kg CO₂)")],-1)),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(o.leaderboard,(function(e,r){return(0,n.uX)(),(0,n.CE)("div",{key:r,class:(0,u.C4)(["leaderboard-row",{highlighted:l.isCurrentUser(e.user_id)}])},[(0,n.Lk)("div",g,[(0,n.Lk)("div",{class:(0,u.C4)(["rank-number",l.getRankClass(e.rank)])},(0,u.v_)(e.rank),3)]),(0,n.Lk)("div",m,(0,u.v_)(e.username),1),(0,n.Lk)("div",w,(0,u.v_)(e.carbon_reduction.toFixed(1)),1)],2)})),128)),0===o.leaderboard.length?((0,n.uX)(),(0,n.CE)("div",C," 暂无排行数据 ")):(0,n.Q3)("",!0)]),r[7]||(r[7]=(0,n.Lk)("div",{class:"leaderboard-tips"},[(0,n.Lk)("h3",null,"如何提高排名?"),(0,n.Lk)("ul",null,[(0,n.Lk)("li",null,"多步行减少碳排放"),(0,n.Lk)("li",null,"通过碳排放计算器记录您的低碳行为"),(0,n.Lk)("li",null,"喂养并升级您的虚拟宠物"),(0,n.Lk)("li",null,"完成成就任务获得额外奖励")])],-1))])}var A=a(4048),_=a(388),R=(a(4114),a(8407)),E=a.n(R);const y={data:function(){return{leaderboard:[],userRank:null,username:"",limit:10}},created:function(){var e=this;return(0,_.A)((0,A.A)().mark((function r(){var a,n;return(0,A.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(r.prev=0,a=localStorage.getItem("token"),a){r.next=5;break}return e.$router.push("/"),r.abrupt("return");case 5:return r.next=7,E().get("http://localhost:5000/api/auth/user",{headers:{Authorization:"Bearer ".concat(a)}});case 7:return n=r.sent,e.username=n.data.username,r.next=11,e.loadLeaderboard();case 11:r.next=16;break;case 13:r.prev=13,r.t0=r["catch"](0),console.error("Error loading leaderboard data:",r.t0);case 16:case"end":return r.stop()}}),r,null,[[0,13]])})))()},methods:{loadLeaderboard:function(){var e=this;return(0,_.A)((0,A.A)().mark((function r(){var a,n;return(0,A.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,a=localStorage.getItem("token"),r.next=4,E().get("http://localhost:5000/api/leaderboard?limit=".concat(e.limit),{headers:{Authorization:"Bearer ".concat(a)}});case 4:n=r.sent,e.leaderboard=n.data.leaderboard,e.userRank=n.data.userRank,r.next=12;break;case 9:r.prev=9,r.t0=r["catch"](0),console.error("Error loading leaderboard:",r.t0);case 12:case"end":return r.stop()}}),r,null,[[0,9]])})))()},updateLeaderboard:function(){var e=this;return(0,_.A)((0,A.A)().mark((function r(){var a;return(0,A.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,a=localStorage.getItem("token"),r.next=4,E().post("http://localhost:5000/api/leaderboard/update",{},{headers:{Authorization:"Bearer ".concat(a)}});case 4:return r.next=6,e.loadLeaderboard();case 6:alert("排行榜已更新"),r.next=12;break;case 9:r.prev=9,r.t0=r["catch"](0),console.error("Error updating leaderboard:",r.t0);case 12:case"end":return r.stop()}}),r,null,[[0,9]])})))()},isCurrentUser:function(e){return this.userRank&&this.userRank.user_id===e},getRankClass:function(e){return 1===e?"gold":2===e?"silver":3===e?"bronze":""}}};var F=a(1241);const I=(0,F.A)(y,[["render",x],["__scopeId","data-v-e6317d56"]]),X=I,N={components:{Navbar:l.A,Leaderboard:X}},z=(0,F.A)(N,[["render",o],["__scopeId","data-v-352d28fb"]]),S=z},9868:(e,r,a)=>{var n=a(6518),t=a(9504),o=a(1291),l=a(1240),s=a(2333),u=a(9039),d=RangeError,i=String,c=Math.floor,k=t(s),v=t("".slice),h=t(1..toFixed),p=function(e,r,a){return 0===r?a:r%2===1?p(e,r-1,a*e):p(e*e,r/2,a)},b=function(e){var r=0,a=e;while(a>=4096)r+=12,a/=4096;while(a>=2)r+=1,a/=2;return r},f=function(e,r,a){var n=-1,t=a;while(++n<6)t+=r*e[n],e[n]=t%1e7,t=c(t/1e7)},L=function(e,r){var a=6,n=0;while(--a>=0)n+=e[a],e[a]=c(n/r),n=n%r*1e7},g=function(e){var r=6,a="";while(--r>=0)if(""!==a||0===r||0!==e[r]){var n=i(e[r]);a=""===a?n:a+k("0",7-n.length)+n}return a},m=u((function(){return"0.000"!==h(8e-5,3)||"1"!==h(.9,0)||"1.25"!==h(1.255,2)||"1000000000000000128"!==h(0xde0b6b3a7640080,0)}))||!u((function(){h({})}));n({target:"Number",proto:!0,forced:m},{toFixed:function(e){var r,a,n,t,s=l(this),u=o(e),c=[0,0,0,0,0,0],h="",m="0";if(u<0||u>20)throw new d("Incorrect fraction digits");if(s!==s)return"NaN";if(s<=-1e21||s>=1e21)return i(s);if(s<0&&(h="-",s=-s),s>1e-21)if(r=b(s*p(2,69,1))-69,a=r<0?s*p(2,-r,1):s/p(2,r,1),a*=4503599627370496,r=52-r,r>0){f(c,0,a),n=u;while(n>=7)f(c,1e7,0),n-=7;f(c,p(10,n,1),0),n=r-1;while(n>=23)L(c,1<<23),n-=23;L(c,1<<n),f(c,1,1),L(c,2),m=g(c)}else f(c,0,a),f(c,1<<-r,0),m=g(c)+k("0",u);return u>0?(t=m.length,m=h+(t<=u?"0."+k("0",u-t)+m:v(m,0,t-u)+"."+v(m,t-u))):m=h+m,m}})}}]);
//# sourceMappingURL=565.024e7594.js.map