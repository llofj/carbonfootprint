"use strict";(self["webpackChunkecopaw"]=self["webpackChunkecopaw"]||[]).push([[825],{5825:(e,n,t)=>{t.r(n),t.d(n,{default:()=>T});var r=t(6768),a={class:"content"};function c(e,n,t,c,s,i){var o=(0,r.g2)("Navbar"),u=(0,r.g2)("Achievements");return(0,r.uX)(),(0,r.CE)("div",null,[(0,r.bF)(o),(0,r.Lk)("div",a,[(0,r.bF)(u)])])}var s=t(354),i=(t(2675),t(9463),t(2010),t(9868),t(4232)),o={class:"achievements-page"},u={class:"achievement-summary"},l={class:"summary-card"},h={class:"summary-count"},v={class:"summary-card"},d={class:"summary-count"},k={class:"summary-card"},m={class:"summary-count"},p={class:"achievement-container"},f={class:"achievement-icon"},A={class:"achievement-info"},w={key:0,class:"unlock-date"},g={key:1,class:"locked-badge"},b={class:"check-achievements"},x={key:0,class:"new-achievements"},L={class:"achievement-list"};function y(e,n,t,a,c,s){return(0,r.uX)(),(0,r.CE)("div",o,[n[6]||(n[6]=(0,r.Lk)("h2",null,"我的成就",-1)),(0,r.Lk)("div",u,[(0,r.Lk)("div",l,[n[1]||(n[1]=(0,r.Lk)("h3",null,"成就总数",-1)),(0,r.Lk)("div",h,(0,i.v_)(c.userAchievements.length)+" / "+(0,i.v_)(c.achievementTypes.length),1)]),(0,r.Lk)("div",v,[n[2]||(n[2]=(0,r.Lk)("h3",null,"减排总量",-1)),(0,r.Lk)("div",d,(0,i.v_)(c.carbonReduction.toFixed(1))+" kg CO₂",1)]),(0,r.Lk)("div",k,[n[3]||(n[3]=(0,r.Lk)("h3",null,"排行榜排名",-1)),(0,r.Lk)("div",m,"#"+(0,i.v_)(c.userRank?c.userRank.rank:"N/A"),1)])]),(0,r.Lk)("div",p,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(c.achievementTypes,(function(e){return(0,r.uX)(),(0,r.CE)("div",{key:e.id,class:(0,i.C4)(["achievement-card",{unlocked:s.isUnlocked(e.id)}])},[(0,r.Lk)("div",f,[(0,r.Lk)("i",{class:(0,i.C4)(["fas",e.icon])},null,2)]),(0,r.Lk)("div",A,[(0,r.Lk)("h3",null,(0,i.v_)(e.name),1),(0,r.Lk)("p",null,(0,i.v_)(e.description),1),s.isUnlocked(e.id)?((0,r.uX)(),(0,r.CE)("div",w," 解锁于: "+(0,i.v_)(s.getUnlockDate(e.id)),1)):((0,r.uX)(),(0,r.CE)("div",g," 未解锁 "))])],2)})),128))]),(0,r.Lk)("div",b,[(0,r.Lk)("button",{onClick:n[0]||(n[0]=function(){return s.checkNewAchievements&&s.checkNewAchievements.apply(s,arguments)}),class:"check-btn"},n[4]||(n[4]=[(0,r.Lk)("i",{class:"fas fa-sync-alt"},null,-1),(0,r.eW)(" 检查新成就 ")]))]),c.newAchievements.length>0?((0,r.uX)(),(0,r.CE)("div",x,[n[5]||(n[5]=(0,r.Lk)("h3",null,"新解锁成就",-1)),(0,r.Lk)("div",L,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(c.newAchievements,(function(e){return(0,r.uX)(),(0,r.CE)("div",{key:e.id,class:"new-achievement"},[(0,r.Lk)("i",{class:(0,i.C4)(["fas",e.icon])},null,2),(0,r.Lk)("span",null,(0,i.v_)(e.achievement_name),1)])})),128))])])):(0,r.Q3)("",!0)])}var C=t(4048),E=t(388),_=(t(113),t(4114),t(5086),t(3288),t(8111),t(116),t(3579),t(6099),t(8407)),R=t.n(_);const U={data:function(){return{achievementTypes:[],userAchievements:[],newAchievements:[],carbonReduction:0,userRank:null}},created:function(){var e=this;return(0,E.A)((0,C.A)().mark((function n(){var t;return(0,C.A)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(n.prev=0,t=localStorage.getItem("token"),t){n.next=5;break}return e.$router.push("/login"),n.abrupt("return");case 5:return n.next=7,e.loadAchievementTypes();case 7:return n.next=9,e.loadUserAchievements();case 9:return n.next=11,e.loadCarbonReduction();case 11:return n.next=13,e.loadUserRank();case 13:n.next=18;break;case 15:n.prev=15,n.t0=n["catch"](0),console.error("Error loading achievements data:",n.t0);case 18:case"end":return n.stop()}}),n,null,[[0,15]])})))()},methods:{loadAchievementTypes:function(){var e=this;return(0,E.A)((0,C.A)().mark((function n(){var t;return(0,C.A)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,R().get("http://localhost:5000/api/achievement/types");case 3:t=n.sent,e.achievementTypes=t.data,n.next=10;break;case 7:n.prev=7,n.t0=n["catch"](0),console.error("Error loading achievement types:",n.t0);case 10:case"end":return n.stop()}}),n,null,[[0,7]])})))()},loadUserAchievements:function(){var e=this;return(0,E.A)((0,C.A)().mark((function n(){var t,r;return(0,C.A)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,t=localStorage.getItem("token"),n.next=4,R().get("http://localhost:5000/api/achievement/user",{headers:{Authorization:"Bearer ".concat(t)}});case 4:r=n.sent,e.userAchievements=r.data,n.next=11;break;case 8:n.prev=8,n.t0=n["catch"](0),console.error("Error loading user achievements:",n.t0);case 11:case"end":return n.stop()}}),n,null,[[0,8]])})))()},loadCarbonReduction:function(){var e=this;return(0,E.A)((0,C.A)().mark((function n(){var t,r;return(0,C.A)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,t=localStorage.getItem("token"),n.next=4,R().get("http://localhost:5000/api/achievement/carbon-reduction",{headers:{Authorization:"Bearer ".concat(t)}});case 4:r=n.sent,e.carbonReduction=r.data.carbon_reduction||0,n.next=11;break;case 8:n.prev=8,n.t0=n["catch"](0),console.error("Error loading carbon reduction:",n.t0);case 11:case"end":return n.stop()}}),n,null,[[0,8]])})))()},loadUserRank:function(){var e=this;return(0,E.A)((0,C.A)().mark((function n(){var t,r;return(0,C.A)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,t=localStorage.getItem("token"),n.next=4,R().get("http://localhost:5000/api/leaderboard/user",{headers:{Authorization:"Bearer ".concat(t)}});case 4:r=n.sent,e.userRank=r.data,n.next=11;break;case 8:n.prev=8,n.t0=n["catch"](0),console.error("Error loading user rank:",n.t0);case 11:case"end":return n.stop()}}),n,null,[[0,8]])})))()},isUnlocked:function(e){return this.userAchievements.some((function(n){return n.achievement_id===e}))},getUnlockDate:function(e){var n=this.userAchievements.find((function(n){return n.achievement_id===e}));return n?new Date(n.date).toLocaleDateString():""},checkNewAchievements:function(){var e=this;return(0,E.A)((0,C.A)().mark((function n(){var t,r;return(0,C.A)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,t=localStorage.getItem("token"),n.next=4,R().get("http://localhost:5000/api/achievement/check",{headers:{Authorization:"Bearer ".concat(t)}});case 4:if(r=n.sent,e.newAchievements=r.data.newAchievements,!(e.newAchievements.length>0)){n.next=18;break}return alert("恭喜！您解锁了新成就"),n.next=10,e.loadUserAchievements();case 10:return n.next=12,R().post("http://localhost:5000/api/leaderboard/update",{},{headers:{Authorization:"Bearer ".concat(t)}});case 12:return n.next=14,e.loadUserRank();case 14:return n.next=16,e.loadCarbonReduction();case 16:n.next=19;break;case 18:alert("暂未解锁新成就，继续努力！");case 19:n.next=24;break;case 21:n.prev=21,n.t0=n["catch"](0),console.error("Error checking achievements:",n.t0);case 24:case"end":return n.stop()}}),n,null,[[0,21]])})))()}}};var I=t(1241);const N=(0,I.A)(U,[["render",y],["__scopeId","data-v-bb478b1e"]]),X=N,F={components:{Navbar:s.A,Achievements:X}},S=(0,I.A)(F,[["render",c],["__scopeId","data-v-51585af6"]]),T=S},9868:(e,n,t)=>{var r=t(6518),a=t(9504),c=t(1291),s=t(1240),i=t(2333),o=t(9039),u=RangeError,l=String,h=Math.floor,v=a(i),d=a("".slice),k=a(1..toFixed),m=function(e,n,t){return 0===n?t:n%2===1?m(e,n-1,t*e):m(e*e,n/2,t)},p=function(e){var n=0,t=e;while(t>=4096)n+=12,t/=4096;while(t>=2)n+=1,t/=2;return n},f=function(e,n,t){var r=-1,a=t;while(++r<6)a+=n*e[r],e[r]=a%1e7,a=h(a/1e7)},A=function(e,n){var t=6,r=0;while(--t>=0)r+=e[t],e[t]=h(r/n),r=r%n*1e7},w=function(e){var n=6,t="";while(--n>=0)if(""!==t||0===n||0!==e[n]){var r=l(e[n]);t=""===t?r:t+v("0",7-r.length)+r}return t},g=o((function(){return"0.000"!==k(8e-5,3)||"1"!==k(.9,0)||"1.25"!==k(1.255,2)||"1000000000000000128"!==k(0xde0b6b3a7640080,0)}))||!o((function(){k({})}));r({target:"Number",proto:!0,forced:g},{toFixed:function(e){var n,t,r,a,i=s(this),o=c(e),h=[0,0,0,0,0,0],k="",g="0";if(o<0||o>20)throw new u("Incorrect fraction digits");if(i!==i)return"NaN";if(i<=-1e21||i>=1e21)return l(i);if(i<0&&(k="-",i=-i),i>1e-21)if(n=p(i*m(2,69,1))-69,t=n<0?i*m(2,-n,1):i/m(2,n,1),t*=4503599627370496,n=52-n,n>0){f(h,0,t),r=o;while(r>=7)f(h,1e7,0),r-=7;f(h,m(10,r,1),0),r=n-1;while(r>=23)A(h,1<<23),r-=23;A(h,1<<r),f(h,1,1),A(h,2),g=w(h)}else f(h,0,t),f(h,1<<-n,0),g=w(h)+v("0",o);return o>0?(a=g.length,g=k+(a<=o?"0."+v("0",o-a)+g:d(g,0,a-o)+"."+d(g,a-o))):g=k+g,g}})}}]);
//# sourceMappingURL=825.b9d54e51.js.map