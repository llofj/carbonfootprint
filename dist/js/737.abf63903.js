"use strict";(self["webpackChunkecopaw"]=self["webpackChunkecopaw"]||[]).push([[737],{2737:(e,r,a)=>{a.r(r),a.d(r,{default:()=>X});var t=a(6768),s={class:"login-page"};function o(e,r,a,o,n,u){var i=(0,t.g2)("LoginForm");return(0,t.uX)(),(0,t.CE)("div",s,[(0,t.bF)(i)])}var n=a(5130),u=a(4232),i={class:"login-form"},c={class:"form-group"},l=["disabled"],d={class:"form-group"},p={class:"password-input"},m=["type","disabled"],g={class:"form-group"},b={class:"captcha-group"},f={class:"captcha-input"},k=["disabled"],h=["disabled"],v={key:0},w={key:1},L={key:0,class:"error-container"};function y(e,r,a,s,o,y){return(0,t.uX)(),(0,t.CE)("div",i,[r[14]||(r[14]=(0,t.Lk)("h2",null,"登录",-1)),(0,t.Lk)("form",{onSubmit:r[7]||(r[7]=(0,n.D$)((function(){return y.handleSubmit&&y.handleSubmit.apply(y,arguments)}),["prevent"]))},[(0,t.Lk)("div",c,[r[8]||(r[8]=(0,t.Lk)("label",{for:"username"},"账号:",-1)),(0,t.bo)((0,t.Lk)("input",{type:"text",id:"username","onUpdate:modelValue":r[0]||(r[0]=function(e){return o.username=e}),required:"",disabled:o.isLoading,onInput:r[1]||(r[1]=function(){return y.clearError&&y.clearError.apply(y,arguments)})},null,40,l),[[n.Jo,o.username,void 0,{trim:!0}]])]),(0,t.Lk)("div",d,[r[9]||(r[9]=(0,t.Lk)("label",{for:"password"},"密码:",-1)),(0,t.Lk)("div",p,[(0,t.bo)((0,t.Lk)("input",{type:o.showPassword?"text":"password",id:"password","onUpdate:modelValue":r[2]||(r[2]=function(e){return o.password=e}),required:"",disabled:o.isLoading,onInput:r[3]||(r[3]=function(){return y.clearError&&y.clearError.apply(y,arguments)})},null,40,m),[[n.hp,o.password]]),(0,t.Lk)("i",{class:(0,u.C4)(["fas",o.showPassword?"fa-eye-slash":"fa-eye"]),onClick:r[4]||(r[4]=function(){return y.togglePassword&&y.togglePassword.apply(y,arguments)})},null,2)])]),(0,t.Lk)("div",g,[r[11]||(r[11]=(0,t.Lk)("label",{for:"captcha"},"验证码:",-1)),(0,t.Lk)("div",b,[(0,t.Lk)("div",f,[(0,t.bo)((0,t.Lk)("input",{type:"text",id:"captcha","onUpdate:modelValue":r[5]||(r[5]=function(e){return o.captcha=e}),required:"",disabled:o.isLoading,onInput:r[6]||(r[6]=function(){return y.clearError&&y.clearError.apply(y,arguments)}),maxlength:"4",placeholder:"请输入验证码 (0000)"},null,40,k),[[n.Jo,o.captcha,void 0,{trim:!0}]])]),r[10]||(r[10]=(0,t.Lk)("div",{class:"captcha-code"}," 0000 ",-1))])]),(0,t.Lk)("button",{type:"submit",disabled:o.isLoading||!y.isFormValid},[o.isLoading?((0,t.uX)(),(0,t.CE)("span",v,r[12]||(r[12]=[(0,t.Lk)("i",{class:"fas fa-spinner fa-spin"},null,-1),(0,t.eW)(" 登录中... ")]))):((0,t.uX)(),(0,t.CE)("span",w,"登录"))],8,h),o.errorMessage?((0,t.uX)(),(0,t.CE)("div",L,[r[13]||(r[13]=(0,t.Lk)("i",{class:"fas fa-exclamation-circle"},null,-1)),(0,t.eW)(" "+(0,u.v_)(o.errorMessage),1)])):(0,t.Q3)("",!0)],32)])}var x=a(4048),M=a(388),E=(a(8706),a(4114),a(2762),a(8407)),I=a.n(E),C=a(2674),P=I().create(C.by);const S={data:function(){return{username:"",password:"",captcha:"0000",errorMessage:"",isLoading:!1,showPassword:!1}},computed:{isFormValid:function(){return this.username.trim()&&this.password&&"0000"===this.captcha.trim()}},methods:{clearError:function(){this.errorMessage=""},togglePassword:function(){this.showPassword=!this.showPassword},handleSubmit:function(){var e=this;return(0,M.A)((0,x.A)().mark((function r(){var a,t,s,o,n,u;return(0,x.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(e.isFormValid){r.next=5;break}if("0000"===e.captcha.trim()){r.next=4;break}return e.errorMessage="验证码错误，请输入0000",r.abrupt("return");case 4:return r.abrupt("return");case 5:return e.isLoading=!0,e.errorMessage="",r.prev=7,a={username:e.username.trim(),password:e.password.trim(),captcha:e.captcha.trim()},console.log("正在发送登录请求:",{url:"".concat(C.by.baseURL).concat(C.yl.login),username:a.username}),r.prev=10,r.next=13,P.post(C.yl.login,a);case 13:if(t=r.sent,console.log("服务器响应:",t.data),!t.data||!t.data.token){r.next=22;break}return localStorage.setItem("token",t.data.token),localStorage.setItem("username",e.username.trim()),s=e.$route.query.redirect||"/",r.next=21,e.$router.push(s);case 21:return r.abrupt("return");case 22:if(!t.data||!t.data.message){r.next=25;break}return e.errorMessage=t.data.message,r.abrupt("return");case 25:r.next=45;break;case 27:if(r.prev=27,r.t0=r["catch"](10),console.error("API调用错误:",r.t0),!r.t0.response){r.next=44;break}o=r.t0.response.status,n=r.t0.response.data,r.t1=o,r.next=401===r.t1?36:403===r.t1?38:500===r.t1?40:42;break;case 36:return e.errorMessage="账号或密码错误",r.abrupt("break",43);case 38:return e.errorMessage="验证码错误",r.abrupt("break",43);case 40:return e.errorMessage="服务器错误，请稍后重试",r.abrupt("break",43);case 42:e.errorMessage=(null===n||void 0===n?void 0:n.message)||"登录失败，请稍后重试";case 43:return r.abrupt("return");case 44:console.log("网络错误或服务器未响应，尝试备用登录");case 45:if(console.log("尝试备用登录..."),"test"!==e.username.trim().toLowerCase()||"123456"!==e.password.trim()){r.next=54;break}return console.log("备用登录成功"),localStorage.setItem("token","mock-token-12345"),localStorage.setItem("username",e.username.trim()),u=e.$route.query.redirect||"/",r.next=53,e.$router.push(u);case 53:return r.abrupt("return");case 54:e.errorMessage="无法连接到服务器，请检查网络连接",r.next=61;break;case 57:r.prev=57,r.t2=r["catch"](7),console.error("登录过程中发生意外错误:",r.t2),e.errorMessage="登录过程中发生错误，请稍后重试";case 61:return r.prev=61,e.isLoading=!1,r.finish(61);case 64:case"end":return r.stop()}}),r,null,[[7,57,61,64],[10,27]])})))()}},created:function(){if(localStorage.getItem("token")){var e=this.$route.query.redirect||"/";this.$router.push(e)}}};var $=a(1241);const q=(0,$.A)(S,[["render",y],["__scopeId","data-v-68daf821"]]),A=q,F={components:{LoginForm:A}},V=(0,$.A)(F,[["render",o],["__scopeId","data-v-408f1459"]]),X=V}}]);
//# sourceMappingURL=737.abf63903.js.map