"use strict";(self["webpackChunkecopaw"]=self["webpackChunkecopaw"]||[]).push([[933],{9868:(e,t,a)=>{var n=a(46518),s=a(79504),r=a(91291),i=a(31240),c=a(72333),o=a(79039),l=RangeError,p=String,u=Math.floor,h=s(c),d=s("".slice),v=s(1..toFixed),g=function(e,t,a){return 0===t?a:t%2===1?g(e,t-1,a*e):g(e*e,t/2,a)},k=function(e){var t=0,a=e;while(a>=4096)t+=12,a/=4096;while(a>=2)t+=1,a/=2;return t},m=function(e,t,a){var n=-1,s=a;while(++n<6)s+=t*e[n],e[n]=s%1e7,s=u(s/1e7)},f=function(e,t){var a=6,n=0;while(--a>=0)n+=e[a],e[a]=u(n/t),n=n%t*1e7},x=function(e){var t=6,a="";while(--t>=0)if(""!==a||0===t||0!==e[t]){var n=p(e[t]);a=""===a?n:a+h("0",7-n.length)+n}return a},L=o((function(){return"0.000"!==v(8e-5,3)||"1"!==v(.9,0)||"1.25"!==v(1.255,2)||"1000000000000000128"!==v(0xde0b6b3a7640080,0)}))||!o((function(){v({})}));n({target:"Number",proto:!0,forced:L},{toFixed:function(e){var t,a,n,s,c=i(this),o=r(e),u=[0,0,0,0,0,0],v="",L="0";if(o<0||o>20)throw new l("Incorrect fraction digits");if(c!==c)return"NaN";if(c<=-1e21||c>=1e21)return p(c);if(c<0&&(v="-",c=-c),c>1e-21)if(t=k(c*g(2,69,1))-69,a=t<0?c*g(2,-t,1):c/g(2,t,1),a*=4503599627370496,t=52-t,t>0){m(u,0,a),n=o;while(n>=7)m(u,1e7,0),n-=7;m(u,g(10,n,1),0),n=t-1;while(n>=23)f(u,1<<23),n-=23;f(u,1<<n),m(u,1,1),f(u,2),L=x(u)}else m(u,0,a),m(u,1<<-t,0),L=x(u)+h("0",o);return o>0?(s=L.length,L=v+(s<=o?"0."+h("0",o-s)+L:d(L,0,s-o)+"."+d(L,s-o))):L=v+L,L}})},30744:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Y});var n=a(56768),s={class:"virtual-pet-page-wrapper"},r={class:"content virtual-pet-page"},i={class:"back-to-home"};function c(e,t,a,c,o,l){var p=(0,n.g2)("Navbar"),u=(0,n.g2)("VirtualPet");return(0,n.uX)(),(0,n.CE)("div",s,[(0,n.bF)(p),(0,n.Lk)("div",r,[(0,n.Lk)("div",i,[(0,n.Lk)("button",{onClick:t[0]||(t[0]=function(){return l.goHome&&l.goHome.apply(l,arguments)}),class:"back-btn"},t[1]||(t[1]=[(0,n.Lk)("i",{class:"fas fa-home"},null,-1),(0,n.Lk)("span",null,"返回主页",-1)]))]),(0,n.bF)(u)])])}a(44114),a(62010),a(9868);var o=a(24232),l=a(45130);const p=a.p+"img/pet_dog.a1989e06.png";var u={class:"virtual-pet-page"},h={class:"pet-container"},d={class:"pet-info-card"},v={class:"pet-name"},g={class:"pet-stats"},k={class:"stat"},m={class:"stat"},f={class:"stat"},x={class:"stat"},L={class:"experience-bar"},b={class:"experience-text"},A={class:"current-exp"},w={class:"exp-percentage"},C={class:"pet-animation-container"},E={class:"pet-actions"},y=["disabled"],P=["disabled"],_=["disabled"],T={key:0,class:"warning-message"},S={class:"steps-container"},I={class:"steps-info"},M={key:0,class:"carbon-info"},$={key:1,class:"coins-info"},N={class:"steps-input"},U={key:1,class:"action-result"},H={key:0},F={key:1},Q={key:2};function R(e,t,a,s,r,i){return(0,n.uX)(),(0,n.CE)("div",u,[t[20]||(t[20]=(0,n.Lk)("h2",{class:"page-title"},"我的虚拟宠物",-1)),(0,n.Lk)("div",h,[(0,n.Lk)("div",d,[(0,n.Lk)("div",v,(0,o.v_)(r.pet.name),1),(0,n.Lk)("div",g,[(0,n.Lk)("div",k,[t[5]||(t[5]=(0,n.Lk)("i",{class:"fa fa-star"},null,-1)),(0,n.Lk)("span",null,"等级: "+(0,o.v_)(r.pet.level),1)]),(0,n.Lk)("div",m,[t[7]||(t[7]=(0,n.Lk)("i",{class:"fa fa-heart"},null,-1)),(0,n.Lk)("span",null,[t[6]||(t[6]=(0,n.eW)("健康状态: ")),(0,n.Lk)("span",{class:(0,o.C4)(["health-status",i.getHealthStatusClass(r.pet.health)])},(0,o.v_)(r.pet.health),3)])]),(0,n.Lk)("div",f,[t[8]||(t[8]=(0,n.Lk)("i",{class:"fa fa-coins"},null,-1)),(0,n.Lk)("span",null,"金币: "+(0,o.v_)(r.pet.coins),1)]),(0,n.Lk)("div",x,[t[9]||(t[9]=(0,n.Lk)("i",{class:"fa fa-chart-line"},null,-1)),(0,n.Lk)("span",null,"已获得经验值: "+(0,o.v_)(r.pet.experience),1)])]),(0,n.Lk)("div",L,[(0,n.Lk)("div",{class:"experience-progress",style:(0,o.Tr)({width:i.experiencePercentage+"%"})},null,4),(0,n.Lk)("div",b,[(0,n.Lk)("span",A,(0,o.v_)(i.currentLevelExcessExperience),1),t[10]||(t[10]=(0,n.Lk)("span",{class:"exp-separator"},"/",-1)),t[11]||(t[11]=(0,n.Lk)("span",{class:"next-level-exp"},"100",-1)),(0,n.Lk)("span",w,"("+(0,o.v_)(i.experiencePercentage.toFixed(1))+"%)",1)])])]),(0,n.Lk)("div",C,[(0,n.Lk)("div",{class:(0,o.C4)(["pet-animation",r.animationClass])},t[12]||(t[12]=[(0,n.Lk)("img",{src:p,alt:"碳宝",class:"pet-image"},null,-1)]),2)]),(0,n.Lk)("div",E,[(0,n.Lk)("button",{onClick:t[0]||(t[0]=function(){return i.feedPet&&i.feedPet.apply(i,arguments)}),disabled:r.pet.coins<r.feedingCost,class:"action-btn feed-btn"},[t[13]||(t[13]=(0,n.Lk)("i",{class:"fa fa-utensils"},null,-1)),(0,n.eW)(" 喂食 ("+(0,o.v_)(r.feedingCost)+"金币) ",1)],8,y),(0,n.Lk)("button",{onClick:t[1]||(t[1]=function(){return i.trainPet&&i.trainPet.apply(i,arguments)}),disabled:r.pet.coins<r.trainingCost||"营养不良"===r.pet.health,class:"action-btn train-btn"},[t[14]||(t[14]=(0,n.Lk)("i",{class:"fa fa-dumbbell"},null,-1)),(0,n.eW)(" 训练 ("+(0,o.v_)(r.trainingCost)+"金币) ",1)],8,P),(0,n.Lk)("button",{onClick:t[2]||(t[2]=function(){return i.levelUp&&i.levelUp.apply(i,arguments)}),disabled:r.pet.coins<r.levelUpCost||"营养不良"===r.pet.health,class:"action-btn level-up-btn"},[t[15]||(t[15]=(0,n.Lk)("i",{class:"fa fa-arrow-up"},null,-1)),(0,n.eW)(" 升级 ("+(0,o.v_)(r.levelUpCost)+"金币) ",1)],8,_)])]),"营养不良"===r.pet.health?((0,n.uX)(),(0,n.CE)("div",T,t[16]||(t[16]=[(0,n.Lk)("p",null,"⚠️ 警告：宠物处于营养不良状态！",-1),(0,n.Lk)("p",null,"请先喂食提升健康状态，才能进行训练和升级。",-1)]))):(0,n.Q3)("",!0),(0,n.Lk)("div",S,[t[18]||(t[18]=(0,n.Lk)("h3",null,"微信步数",-1)),(0,n.Lk)("p",I,"今日步数: "+(0,o.v_)(r.steps)+" 步",1),r.carbonReduction?((0,n.uX)(),(0,n.CE)("p",M,"减少碳排放: "+(0,o.v_)(r.carbonReduction.toFixed(2))+" kg CO2",1)):(0,n.Q3)("",!0),r.coinsEarned?((0,n.uX)(),(0,n.CE)("p",$,"获得金币: "+(0,o.v_)(r.coinsEarned),1)):(0,n.Q3)("",!0),(0,n.Lk)("div",N,[(0,n.bo)((0,n.Lk)("input",{type:"number","onUpdate:modelValue":t[3]||(t[3]=function(e){return r.simulatedSteps=e}),placeholder:"输入步数",min:"1000",max:"30000"},null,512),[[l.Jo,r.simulatedSteps]]),(0,n.Lk)("button",{onClick:t[4]||(t[4]=function(){return i.submitSteps&&i.submitSteps.apply(i,arguments)}),class:"submit-steps-btn"},t[17]||(t[17]=[(0,n.Lk)("i",{class:"fa fa-walking"},null,-1),(0,n.eW)(" 提交步数 ")]))]),t[19]||(t[19]=(0,n.Lk)("div",{class:"steps-note"},[(0,n.Lk)("p",null,"注: 在实际应用中，步数将从微信API获取")],-1))]),r.lastAction?((0,n.uX)(),(0,n.CE)("div",U,[(0,n.Lk)("p",null,(0,o.v_)(r.lastAction.message),1),r.lastAction.carbonReduction?((0,n.uX)(),(0,n.CE)("p",H," 减少碳排放: "+(0,o.v_)(r.lastAction.carbonReduction)+"kg CO2 ",1)):(0,n.Q3)("",!0),r.lastAction.coinsEarned?((0,n.uX)(),(0,n.CE)("p",F," 获得金币: "+(0,o.v_)(r.lastAction.coinsEarned),1)):(0,n.Q3)("",!0),r.lastAction.experienceGained?((0,n.uX)(),(0,n.CE)("p",Q," 获得经验值: "+(0,o.v_)(r.lastAction.experienceGained),1)):(0,n.Q3)("",!0)])):(0,n.Q3)("",!0),t[21]||(t[21]=(0,n.Fv)('<div class="info-section" data-v-70292618><h3 data-v-70292618>步行减排说明</h3><ul data-v-70292618><li data-v-70292618>每走1000步可减少约0.1kg碳排放</li><li data-v-70292618>每减少1kg碳排放可获得10个金币</li><li data-v-70292618>金币可用于喂食、训练和直接升级</li><li data-v-70292618>喂食可提升宠物健康状态</li><li data-v-70292618>花费二十金币训练宠物，根据健康状态获得不同经验值：</li><li class="training-info" data-v-70292618><div class="health-status" data-v-70292618><strong data-v-70292618>健康状态：</strong><ul data-v-70292618><li data-v-70292618>健康：20%概率获得1-10经验值，40%概率获得11-30经验值，40%概率获得31-40经验值</li><li data-v-70292618>良好：40%概率获得1-10经验值，40%概率获得11-30经验值，20%概率获得31-40经验值</li><li data-v-70292618>较差：60%概率获得1-10经验值，20%概率获得11-30经验值，20%概率获得31-40经验值</li><li data-v-70292618>营养不良：无法训练以及升级</li></ul></div></li><li data-v-70292618>每100经验值可提升1级</li><li data-v-70292618>宠物等级越高，减排效果越好</li></ul></div>',1))])}var X=a(14048),z=a(41034),B=a(30388),W=(a(28706),a(26099),a(76031),a(50788)),G=a.n(W);const O={data:function(){return{pet:{name:"碳宝",level:1,health:"健康",coins:0,experience:0},steps:0,simulatedSteps:8e3,carbonReduction:0,coinsEarned:0,animationClass:"",animationTimeout:null,experienceToNextLevel:100,feedingCost:10,trainingCost:20,levelUpCost:100,lastAction:null,healthCheckInterval:null,lastHealth:"健康",isLevelingUp:!1,tempExperiencePercentage:0}},computed:{nextLevelExperience:function(){return 100*this.pet.level},experiencePercentage:function(){return this.isLevelingUp?this.tempExperiencePercentage:this.currentLevelExcessExperience/100*100},currentLevelExcessExperience:function(){var e=100*(this.pet.level-1);return this.pet.experience-e}},created:function(){var e=this;return(0,B.A)((0,X.A)().mark((function t(){var a,n;return(0,X.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,a=localStorage.getItem("token"),a){t.next=5;break}return e.$router.push("/"),t.abrupt("return");case 5:return t.next=7,G().get("http://localhost:5000/api/pet",{headers:{Authorization:"Bearer ".concat(a)}});case 7:n=t.sent,e.pet=(0,z.A)((0,z.A)({},n.data),{},{name:"碳宝"}),e.lastHealth=e.pet.health,e.experienceToNextLevel=n.data.experienceToNextLevel,e.startHealthCheck(),t.next=17;break;case 14:t.prev=14,t.t0=t["catch"](0),console.error("Error fetching pet data:",t.t0);case 17:case"end":return t.stop()}}),t,null,[[0,14]])})))()},beforeUnmount:function(){this.healthCheckInterval&&clearInterval(this.healthCheckInterval)},methods:{getHealthStatusClass:function(e){return{"health-healthy":"健康"===e,"health-good":"良好"===e,"health-poor":"较差"===e,"health-malnourished":"营养不良"===e}},submitSteps:function(){var e=this;return(0,B.A)((0,X.A)().mark((function t(){var a,n;return(0,X.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,!(e.simulatedSteps<1e3)){t.next=4;break}return e.$store.dispatch("message/showMessage",{content:"步数太少，请至少输入1000步",type:"warning"}),t.abrupt("return");case 4:return a=localStorage.getItem("token"),t.next=7,G().post("http://localhost:5000/api/pet/steps",{steps:e.simulatedSteps},{headers:{Authorization:"Bearer ".concat(a)}});case 7:n=t.sent,e.pet=(0,z.A)((0,z.A)({},n.data.pet),{},{name:"碳宝"}),e.steps=n.data.stepsProcessed,e.carbonReduction=n.data.carbonReduction,e.coinsEarned=n.data.coinsEarned,e.playAnimation("bounce"),e.$store.dispatch("message/showMessage",{content:"步数提交成功！减少了".concat(n.data.carbonReduction.toFixed(2),"kg碳排放，获得了").concat(n.data.coinsEarned,"金币！"),type:"success"}),e.lastAction=n.data,t.next=21;break;case 17:t.prev=17,t.t0=t["catch"](0),console.error("Error submitting steps:",t.t0),e.$store.dispatch("message/showMessage",{content:"提交步数失败，请重试",type:"error"});case 21:case"end":return t.stop()}}),t,null,[[0,17]])})))()},feedPet:function(){var e=this;return(0,B.A)((0,X.A)().mark((function t(){var a,n;return(0,X.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,!(e.pet.coins<e.feedingCost)){t.next=4;break}return e.$store.dispatch("message/showMessage",{content:"金币不足，无法喂食",type:"error"}),t.abrupt("return");case 4:return a=localStorage.getItem("token"),t.next=7,G().post("http://localhost:5000/api/pet/feed",{},{headers:{Authorization:"Bearer ".concat(a)}});case 7:n=t.sent,e.pet=(0,z.A)((0,z.A)({},n.data.pet),{},{name:"碳宝"}),e.lastHealth=e.pet.health,e.playAnimation("wiggle"),e.$store.dispatch("message/showMessage",{content:n.data.message,type:"success"}),e.lastAction=n.data,t.next=19;break;case 15:t.prev=15,t.t0=t["catch"](0),console.error("Error feeding pet:",t.t0),e.$store.dispatch("message/showMessage",{content:"喂食失败，请重试",type:"error"});case 19:case"end":return t.stop()}}),t,null,[[0,15]])})))()},trainPet:function(){var e=this;return(0,B.A)((0,X.A)().mark((function t(){var a,n;return(0,X.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,!(e.pet.coins<e.trainingCost||"营养不良"===e.pet.health)){t.next=4;break}return e.$store.dispatch("message/showMessage",{content:"金币不足或健康状态不佳，无法训练",type:"error"}),t.abrupt("return");case 4:return a=localStorage.getItem("token"),t.next=7,G().post("http://localhost:5000/api/pet/train",{},{headers:{Authorization:"Bearer ".concat(a)}});case 7:n=t.sent,e.pet=(0,z.A)((0,z.A)({},n.data.pet),{},{name:"碳宝"}),e.experienceToNextLevel=n.data.experienceToNextLevel,e.playAnimation("shake"),e.$store.dispatch("message/showMessage",{content:"训练成功！获得".concat(n.data.experienceGained,"经验值，距离下一级还需").concat(e.experienceToNextLevel,"经验值"),type:"success"}),e.lastAction=n.data,t.next=19;break;case 15:t.prev=15,t.t0=t["catch"](0),console.error("Error training pet:",t.t0),e.$store.dispatch("message/showMessage",{content:"训练失败，请重试",type:"error"});case 19:case"end":return t.stop()}}),t,null,[[0,15]])})))()},levelUp:function(){var e=this;return(0,B.A)((0,X.A)().mark((function t(){var a,n;return(0,X.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,!(e.pet.coins<e.levelUpCost||"营养不良"===e.pet.health)){t.next=4;break}return e.$store.dispatch("message/showMessage",{content:"金币不足或健康状态不佳，无法升级",type:"error"}),t.abrupt("return");case 4:return a=localStorage.getItem("token"),t.next=7,G().post("http://localhost:5000/api/pet/level-up",{},{headers:{Authorization:"Bearer ".concat(a)}});case 7:return n=t.sent,e.isLevelingUp=!0,e.tempExperiencePercentage=e.experiencePercentage,t.next=12,e.animateExperience(100,500);case 12:return t.next=14,new Promise((function(e){return setTimeout(e,200)}));case 14:return e.tempExperiencePercentage=0,t.next=17,new Promise((function(e){return setTimeout(e,100)}));case 17:e.pet=(0,z.A)((0,z.A)({},n.data.pet),{},{name:"碳宝"}),e.experienceToNextLevel=n.data.experienceToNextLevel,e.isLevelingUp=!1,e.playAnimation("grow"),e.$store.dispatch("message/showMessage",{content:"升级成功！当前等级：".concat(e.pet.level,"，获得").concat(n.data.experienceGained,"经验值，距离下一级还需").concat(e.experienceToNextLevel,"经验值"),type:"success"}),e.lastAction=n.data,t.next=30;break;case 25:t.prev=25,t.t0=t["catch"](0),console.error("Error leveling up pet:",t.t0),e.$store.dispatch("message/showMessage",{content:"升级失败，请重试",type:"error"}),e.isLevelingUp=!1;case 30:case"end":return t.stop()}}),t,null,[[0,25]])})))()},animateExperience:function(e,t){var a=this;return(0,B.A)((0,X.A)().mark((function n(){var s,r;return(0,X.A)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return s=a.tempExperiencePercentage,r=performance.now(),n.abrupt("return",new Promise((function(n){var i=function(c){var o=c-r,l=Math.min(o/t,1),p=a.easeOutQuad(l);a.tempExperiencePercentage=s+(e-s)*p,l<1?requestAnimationFrame(i):n()};requestAnimationFrame(i)})));case 3:case"end":return n.stop()}}),n)})))()},easeOutQuad:function(e){return e*(2-e)},playAnimation:function(e){var t=this;this.animationTimeout&&clearTimeout(this.animationTimeout),this.animationClass=e,this.animationTimeout=setTimeout((function(){t.animationClass=""}),1500)},startHealthCheck:function(){var e=this;this.healthCheckInterval=setInterval((0,B.A)((0,X.A)().mark((function t(){var a,n,s,r,i;return(0,X.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,a=localStorage.getItem("token"),t.next=4,G().get("http://localhost:5000/api/pet",{headers:{Authorization:"Bearer ".concat(a)}});case 4:n=t.sent,s=n.data.health,e.pet=(0,z.A)((0,z.A)({},n.data),{},{name:"碳宝"}),s!==e.lastHealth&&(r="",i="warning","营养不良"===s?(r="警告：宠物处于营养不良状态！请及时喂食。",i="error"):"较差"===s?(r="提示：宠物健康状态下降，建议喂食。",i="warning"):"良好"===s?(r="提示：宠物健康状态良好，继续保持。",i="info"):"健康"===s&&(r="提示：宠物健康状态极佳！",i="success"),e.$store.dispatch("message/showMessage",{content:r,type:i}),e.lastHealth=s,"营养不良"===s&&(e.pet.health="营养不良")),t.next=13;break;case 10:t.prev=10,t.t0=t["catch"](0),console.error("Error checking pet health:",t.t0);case 13:case"end":return t.stop()}}),t,null,[[0,10]])}))),3e4)}}};var V=a(71241);const q=(0,V.A)(O,[["render",R],["__scopeId","data-v-70292618"]]),J=q;var j=a(4809);const D={components:{VirtualPet:J,Navbar:j.A},methods:{goHome:function(){this.$router.push("/")}}},K=(0,V.A)(D,[["render",c],["__scopeId","data-v-333c49fe"]]),Y=K}}]);
//# sourceMappingURL=933.c769426e.js.map