"use strict";(self["webpackChunkecopaw"]=self["webpackChunkecopaw"]||[]).push([[57],{9868:(e,t,n)=>{var a=n(46518),r=n(79504),c=n(91291),s=n(31240),i=n(72333),o=n(79039),l=RangeError,u=String,h=Math.floor,d=r(i),v=r("".slice),k=r(1..toFixed),m=function(e,t,n){return 0===t?n:t%2===1?m(e,t-1,n*e):m(e*e,t/2,n)},p=function(e){var t=0,n=e;while(n>=4096)t+=12,n/=4096;while(n>=2)t+=1,n/=2;return t},f=function(e,t,n){var a=-1,r=n;while(++a<6)r+=t*e[a],e[a]=r%1e7,r=h(r/1e7)},A=function(e,t){var n=6,a=0;while(--n>=0)a+=e[n],e[n]=h(a/t),a=a%t*1e7},g=function(e){var t=6,n="";while(--t>=0)if(""!==n||0===t||0!==e[t]){var a=u(e[t]);n=""===n?a:n+d("0",7-a.length)+a}return n},y=o((function(){return"0.000"!==k(8e-5,3)||"1"!==k(.9,0)||"1.25"!==k(1.255,2)||"1000000000000000128"!==k(0xde0b6b3a7640080,0)}))||!o((function(){k({})}));a({target:"Number",proto:!0,forced:y},{toFixed:function(e){var t,n,a,r,i=s(this),o=c(e),h=[0,0,0,0,0,0],k="",y="0";if(o<0||o>20)throw new l("Incorrect fraction digits");if(i!==i)return"NaN";if(i<=-1e21||i>=1e21)return u(i);if(i<0&&(k="-",i=-i),i>1e-21)if(t=p(i*m(2,69,1))-69,n=t<0?i*m(2,-t,1):i/m(2,t,1),n*=4503599627370496,t=52-t,t>0){f(h,0,n),a=o;while(a>=7)f(h,1e7,0),a-=7;f(h,m(10,a,1),0),a=t-1;while(a>=23)A(h,1<<23),a-=23;A(h,1<<a),f(h,1,1),A(h,2),y=g(h)}else f(h,0,n),f(h,1<<-t,0),y=g(h)+d("0",o);return o>0?(r=y.length,y=k+(r<=o?"0."+d("0",o-r)+y:v(y,0,r-o)+"."+v(y,r-o))):y=k+y,y}})},59057:(e,t,n)=>{n.r(t),n.d(t,{default:()=>ce});var a=n(56768),r={class:"content achievements-page"},c={class:"back-to-home"};function s(e,t,n,s,i,o){var l=(0,a.g2)("Navbar"),u=(0,a.g2)("Achievements");return(0,a.uX)(),(0,a.CE)("div",null,[(0,a.bF)(l),(0,a.Lk)("div",r,[(0,a.Lk)("div",c,[(0,a.Lk)("button",{onClick:t[0]||(t[0]=function(){return o.goHome&&o.goHome.apply(o,arguments)}),class:"back-btn"},t[1]||(t[1]=[(0,a.Lk)("i",{class:"fas fa-home"},null,-1),(0,a.Lk)("span",null,"返回主页",-1)]))]),(0,a.bF)(u)])])}n(44114);var i=n(4809),o=(n(52675),n(89463),n(62010),n(2892),n(9868),n(24232)),l={class:"achievements-page"},u={key:0,class:"error-message"},h={key:1,class:"loading-container"},d={key:2,class:"checking-achievements-modal"},v={class:"checking-content"},k={key:0,class:"check-result"},m={key:1,class:"check-result success"},p={class:"new-achievements-list"},f={key:3},A={class:"achievement-summary"},g={class:"summary-card"},y={class:"summary-card-content"},L={class:"summary-count"},b={class:"summary-card"},w={class:"summary-card-content"},C={class:"summary-count carbon-value"},x={class:"summary-card"},_={class:"summary-card-content"},R={class:"summary-count rank-value"},E={key:0},T={class:"achievements-status"},U={key:0,class:"status-message unlocked-message"},X={key:1,class:"status-message locked-message"},N={key:0},I={class:"achievement-container"},F=["data-achievement-id"],Q={class:"achievement-icon"},S={class:"achievement-info"},W={class:"unlock-date"},z={class:"achievement-container"},B=["data-achievement-id"],H={class:"achievement-icon"},D={class:"achievement-info"},O={class:"unlock-hint"},K={key:1,class:"empty-state"},$={class:"check-achievements"},M=["disabled"];function j(e,t,n,r,c,s){return(0,a.uX)(),(0,a.CE)("div",l,[t[21]||(t[21]=(0,a.Lk)("h2",{class:"page-title"},"我的成就",-1)),c.error?((0,a.uX)(),(0,a.CE)("div",u,[t[3]||(t[3]=(0,a.Lk)("i",{class:"fas fa-exclamation-circle"},null,-1)),(0,a.eW)(" "+(0,o.v_)(c.error),1)])):(0,a.Q3)("",!0),c.loading&&!c.checkingAchievements?((0,a.uX)(),(0,a.CE)("div",h,t[4]||(t[4]=[(0,a.Lk)("div",{class:"loading-message"},[(0,a.Lk)("i",{class:"fas fa-spinner fa-spin"}),(0,a.Lk)("p",null,"加载成就数据中...")],-1)]))):(0,a.Q3)("",!0),c.checkingAchievements?((0,a.uX)(),(0,a.CE)("div",d,[(0,a.Lk)("div",v,[t[9]||(t[9]=(0,a.Lk)("i",{class:"fas fa-spinner fa-spin"},null,-1)),t[10]||(t[10]=(0,a.Lk)("p",null,"正在检查新成就...",-1)),c.checkCompleted&&!c.hasNewAchievements?((0,a.uX)(),(0,a.CE)("div",k,[t[5]||(t[5]=(0,a.Lk)("i",{class:"fas fa-info-circle"},null,-1)),t[6]||(t[6]=(0,a.Lk)("p",null,"暂未解锁新成就，继续努力！",-1)),(0,a.Lk)("button",{onClick:t[0]||(t[0]=function(){return s.dismissCheckResult&&s.dismissCheckResult.apply(s,arguments)}),class:"dismiss-btn"},"返回")])):(0,a.Q3)("",!0),c.checkCompleted&&c.hasNewAchievements?((0,a.uX)(),(0,a.CE)("div",m,[t[7]||(t[7]=(0,a.Lk)("i",{class:"fas fa-trophy"},null,-1)),t[8]||(t[8]=(0,a.Lk)("p",null,"恭喜！您解锁了新成就！",-1)),(0,a.Lk)("div",p,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(c.newAchievements,(function(e){return(0,a.uX)(),(0,a.CE)("div",{key:e.id,class:"new-achievement-item"},[(0,a.Lk)("i",{class:(0,o.C4)(["fas",e.icon])},null,2),(0,a.Lk)("span",null,(0,o.v_)(e.achievement_name),1)])})),128))]),(0,a.Lk)("button",{onClick:t[1]||(t[1]=function(){return s.dismissCheckResult&&s.dismissCheckResult.apply(s,arguments)}),class:"dismiss-btn success"},"查看成就")])):(0,a.Q3)("",!0)])])):(0,a.Q3)("",!0),c.loading||c.error||c.checkingAchievements?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",f,[(0,a.Lk)("div",A,[(0,a.Lk)("div",g,[(0,a.Lk)("div",y,[t[11]||(t[11]=(0,a.Lk)("div",{class:"card-title"},"成就总数",-1)),(0,a.Lk)("div",L,(0,o.v_)(s.getUnlockedAchievementsCount())+" / "+(0,o.v_)(c.achievementTypes&&c.achievementTypes.length||0),1)])]),(0,a.Lk)("div",b,[(0,a.Lk)("div",w,[t[12]||(t[12]=(0,a.Lk)("div",{class:"card-title"},"减排总量",-1)),(0,a.Lk)("div",C,(0,o.v_)(c.userRank&&c.userRank.carbon_reduction?Number(c.userRank.carbon_reduction).toFixed(1):c.carbonReduction.toFixed(1))+" kg CO₂",1)])]),(0,a.Lk)("div",x,[(0,a.Lk)("div",_,[t[13]||(t[13]=(0,a.Lk)("div",{class:"card-title"},"排行榜排名",-1)),(0,a.Lk)("div",R,"#"+(0,o.v_)(c.userRank&&c.userRank.rank?c.userRank.rank:"N/A"),1)])])]),c.achievementTypes&&c.achievementTypes.length>0?((0,a.uX)(),(0,a.CE)("div",E,[(0,a.Lk)("div",T,[s.getUnlockedAchievementsCount()>0?((0,a.uX)(),(0,a.CE)("p",U,[t[14]||(t[14]=(0,a.Lk)("i",{class:"fas fa-medal"},null,-1)),(0,a.eW)(" 您已解锁 "+(0,o.v_)(s.getUnlockedAchievementsCount())+" 项成就，继续努力！ ",1)])):((0,a.uX)(),(0,a.CE)("p",X,t[15]||(t[15]=[(0,a.Lk)("i",{class:"fas fa-lock"},null,-1),(0,a.eW)(" 您尚未解锁任何成就，立即开始减碳行动吧！ ")])))]),s.unlockedAchievements.length>0?((0,a.uX)(),(0,a.CE)("div",N,[t[16]||(t[16]=(0,a.Lk)("h3",{class:"section-title"},[(0,a.Lk)("i",{class:"fas fa-unlock-alt"}),(0,a.eW)(" 已解锁的成就 ")],-1)),(0,a.Lk)("div",I,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(s.unlockedAchievements,(function(e){return(0,a.uX)(),(0,a.CE)("div",{key:e.id,class:"achievement-card unlocked","data-achievement-id":e.id},[(0,a.Lk)("div",Q,[(0,a.Lk)("i",{class:(0,o.C4)(["fas",e.icon]),style:{color:"white"}},null,2)]),(0,a.Lk)("div",S,[(0,a.Lk)("h3",null,(0,o.v_)(e.name),1),(0,a.Lk)("p",null,(0,o.v_)(e.description),1),(0,a.Lk)("div",W," 解锁于: "+(0,o.v_)(s.getUnlockDate(e.id)),1)])],8,F)})),128))])])):(0,a.Q3)("",!0),t[18]||(t[18]=(0,a.Lk)("h3",{class:"section-title"},[(0,a.Lk)("i",{class:"fas fa-lock"}),(0,a.eW)(" 待解锁的成就 ")],-1)),(0,a.Lk)("div",z,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(s.lockedAchievements,(function(e){return(0,a.uX)(),(0,a.CE)("div",{key:"locked-"+e.id,class:"achievement-card locked","data-achievement-id":e.id},[(0,a.Lk)("div",H,[(0,a.Lk)("i",{class:(0,o.C4)(["fas",e.icon])},null,2)]),(0,a.Lk)("div",D,[(0,a.Lk)("h3",null,(0,o.v_)(e.name),1),(0,a.Lk)("p",null,(0,o.v_)(e.description),1),t[17]||(t[17]=(0,a.Lk)("div",{class:"locked-badge"},[(0,a.Lk)("i",{class:"fas fa-lock"}),(0,a.eW)(" 未解锁 ")],-1)),(0,a.Lk)("div",O,(0,o.v_)(s.getUnlockHint(e)),1)])],8,B)})),128))])])):c.loading?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",K,t[19]||(t[19]=[(0,a.Lk)("i",{class:"fas fa-award empty-icon"},null,-1),(0,a.Lk)("p",null,"暂无可用成就",-1),(0,a.Lk)("p",{class:"empty-description"},"系统尚未配置任何成就，请稍后再试",-1)]))),(0,a.Lk)("div",$,[(0,a.Lk)("button",{onClick:t[2]||(t[2]=function(){return s.checkNewAchievements&&s.checkNewAchievements.apply(s,arguments)}),class:"check-btn",disabled:!c.achievementTypes||0===c.achievementTypes.length||c.loading},[(0,a.Lk)("i",{class:(0,o.C4)(["fas fa-sync-alt",{"fa-spin":c.checkingAchievements}])},null,2),t[20]||(t[20]=(0,a.eW)(" 检查新成就 "))],8,M)])]))])}var q=n(41034),G=n(14048),J=n(30388),P=n(59258),V=(n(16280),n(76918),n(2008),n(50113),n(64346),n(62062),n(15086),n(26910),n(23288),n(18111),n(22489),n(20116),n(61701),n(13579),n(26099),n(50788)),Y=n.n(V);const Z={data:function(){return{achievementTypes:[],userAchievements:[],newAchievements:[],carbonReduction:0,userRank:null,loading:!0,error:null,checkingAchievements:!1,checkCompleted:!1,hasNewAchievements:!1}},computed:{unlockedAchievements:function(){var e=this;return this.achievementTypes&&this.userAchievements?this.achievementTypes.filter((function(t){return t&&t.id&&e.isUnlocked(t.id)})):[]},lockedAchievements:function(){var e=this;return this.achievementTypes&&this.userAchievements?this.achievementTypes.filter((function(t){return t&&t.id&&!e.isUnlocked(t.id)})):[]},sortedAchievements:function(){var e=this;return this.achievementTypes&&Array.isArray(this.achievementTypes)&&0!==this.achievementTypes.length?(0,P.A)(this.achievementTypes).sort((function(t,n){if(!t||!n||!t.id||!n.id)return 0;var a=e.isUnlocked(t.id),r=e.isUnlocked(n.id);return a&&!r?-1:!a&&r?1:t.id.localeCompare(n.id)})):[]}},created:function(){var e=this;return(0,J.A)((0,G.A)().mark((function t(){var n;return(0,G.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,e.loading=!0,e.error=null,n=localStorage.getItem("token"),n){t.next=7;break}return e.$router.push("/login"),t.abrupt("return");case 7:return t.next=9,e.loadUserRank();case 9:return t.next=11,e.loadAchievementTypes();case 11:return t.next=13,e.loadUserAchievements();case 13:if(e.userRank&&e.userRank.carbon_reduction){t.next=18;break}return t.next=16,e.loadCarbonReduction();case 16:t.next=19;break;case 18:e.carbonReduction=e.userRank.carbon_reduction;case 19:t.next=25;break;case 21:t.prev=21,t.t0=t["catch"](0),console.error("Error loading achievements data:",t.t0),e.error="加载成就数据失败，请稍后再试";case 25:return t.prev=25,e.loading=!1,t.finish(25);case 28:case"end":return t.stop()}}),t,null,[[0,21,25,28]])})))()},methods:{loadAchievementTypes:function(){var e=this;return(0,J.A)((0,G.A)().mark((function t(){var n,a;return(0,G.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Y().get("http://localhost:5000/api/achievement/types");case 3:n=t.sent,n.data&&Array.isArray(n.data)?(a=n.data.filter((function(e){return e&&e.id})).map((function(e){return(0,q.A)({},e)})),a.length>0?e.achievementTypes=a:(console.error("No valid achievement types found in response"),e.achievementTypes=[])):(console.error("Achievement types data is not an array or is empty:",n.data),e.achievementTypes=[]),t.next=12;break;case 7:throw t.prev=7,t.t0=t["catch"](0),console.error("Error loading achievement types:",t.t0),e.achievementTypes=[],t.t0;case 12:case"end":return t.stop()}}),t,null,[[0,7]])})))()},loadUserAchievements:function(){var e=this;return(0,J.A)((0,G.A)().mark((function t(){var n,a;return(0,G.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,n=localStorage.getItem("token"),t.next=4,Y().get("http://localhost:5000/api/achievement/user",{headers:{Authorization:"Bearer ".concat(n)}});case 4:a=t.sent,e.userAchievements=a.data,t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](0),console.error("Error loading user achievements:",t.t0);case 11:case"end":return t.stop()}}),t,null,[[0,8]])})))()},loadCarbonReduction:function(){var e=this;return(0,J.A)((0,G.A)().mark((function t(){var n,a,r;return(0,G.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,n=localStorage.getItem("token"),t.next=4,Y().get("http://localhost:5000/api/leaderboard/user",{headers:{Authorization:"Bearer ".concat(n)}});case 4:if(a=t.sent,!a.data||!a.data.carbon_reduction){t.next=9;break}e.carbonReduction=a.data.carbon_reduction,t.next=13;break;case 9:return t.next=11,Y().get("http://localhost:5000/api/achievement/carbon-reduction",{headers:{Authorization:"Bearer ".concat(n)}});case 11:r=t.sent,e.carbonReduction=r.data.carbon_reduction||0;case 13:t.next=19;break;case 15:t.prev=15,t.t0=t["catch"](0),console.error("Error loading carbon reduction:",t.t0),e.carbonReduction=0;case 19:case"end":return t.stop()}}),t,null,[[0,15]])})))()},loadUserRank:function(){var e=this;return(0,J.A)((0,G.A)().mark((function t(){var n,a;return(0,G.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,n=localStorage.getItem("token"),t.next=4,Y().get("http://localhost:5000/api/leaderboard/user",{headers:{Authorization:"Bearer ".concat(n)}});case 4:a=t.sent,e.userRank=a.data,t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](0),console.error("Error loading user rank:",t.t0);case 11:case"end":return t.stop()}}),t,null,[[0,8]])})))()},isUnlocked:function(e){return!!(e&&this.userAchievements&&Array.isArray(this.userAchievements))&&this.userAchievements.some((function(t){return t&&t.achievement_id===e}))},getUnlockDate:function(e){if(!e||!this.userAchievements||!Array.isArray(this.userAchievements))return"";var t=this.userAchievements.find((function(t){return t&&t.achievement_id===e}));return t&&t.date?new Date(t.date).toLocaleDateString():""},getUnlockedAchievementsCount:function(){var e=this;return this.userAchievements&&Array.isArray(this.userAchievements)&&this.achievementTypes&&Array.isArray(this.achievementTypes)?this.userAchievements.filter((function(t){return t&&t.achievement_id&&e.achievementTypes.some((function(e){return e&&e.id===t.achievement_id}))})).length:0},getUnlockHint:function(e){if(!e)return"";var t={green_commuter:"多步行减少碳排放，累计超过5kg CO₂",carbon_saver:"单日减少碳排放量达到10kg",pet_lover:"升级您的虚拟宠物至5级",eco_warrior:"累计碳减排量达到50kg CO₂",stepping_master:"单日行走步数超过20000步",diet_hero:"减少肉类消费减排量达到10kg CO₂",pet_trainer:"通过训练获得1000经验值",pet_expert:"宠物等级达到10级",pet_master:"宠物等级达到20级",experience_collector:"累计获得5000经验值"};return t[e.id]||"继续减碳行动解锁此成就"},checkNewAchievements:function(){var e=this;return(0,J.A)((0,G.A)().mark((function t(){var n,a;return(0,G.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,e.checkingAchievements=!0,e.checkCompleted=!1,e.hasNewAchievements=!1,e.error=null,n=localStorage.getItem("token"),n){t.next=9;break}return e.$router.push("/login"),t.abrupt("return");case 9:return t.next=11,Y().get("http://localhost:5000/api/achievement/check",{headers:{Authorization:"Bearer ".concat(n)}});case 11:if(a=t.sent,a&&a.data){t.next=14;break}throw new Error("服务器返回无效响应");case 14:if(e.newAchievements=Array.isArray(a.data.newAchievements)?a.data.newAchievements.filter((function(e){return e&&e.id})):[],e.checkCompleted=!0,e.hasNewAchievements=e.newAchievements.length>0,!e.hasNewAchievements){t.next=26;break}return t.next=20,e.loadUserAchievements();case 20:return t.next=22,Y().post("http://localhost:5000/api/leaderboard/update",{},{headers:{Authorization:"Bearer ".concat(n)}});case 22:return t.next=24,e.loadUserRank();case 24:return t.next=26,e.loadCarbonReduction();case 26:t.next=33;break;case 28:t.prev=28,t.t0=t["catch"](0),console.error("Error checking achievements:",t.t0),e.error="检查新成就失败，请稍后再试",e.checkCompleted=!0;case 33:case"end":return t.stop()}}),t,null,[[0,28]])})))()},dismissCheckResult:function(){this.checkingAchievements=!1,this.checkCompleted=!1,this.hasNewAchievements=!1}}};var ee=n(71241);const te=(0,ee.A)(Z,[["render",j],["__scopeId","data-v-6f6397fb"]]),ne=te,ae={components:{Navbar:i.A,Achievements:ne},methods:{goHome:function(){this.$router.push("/")}}},re=(0,ee.A)(ae,[["render",s],["__scopeId","data-v-7c59b303"]]),ce=re}}]);
//# sourceMappingURL=57.4f5ec68d.js.map