"use strict";(self["webpackChunkecopaw"]=self["webpackChunkecopaw"]||[]).push([[511],{82892:(e,r,a)=>{a.r(r),a.d(r,{default:()=>W});var t=a(56768),s={class:"login-page"},n={class:"login-container"};function o(e,r,a,o,c,u){var i=(0,t.g2)("LoginForm");return(0,t.uX)(),(0,t.CE)("div",s,[(0,t.Lk)("div",n,[(0,t.bF)(i)])])}var c=a(45130),u=a(24232),i={class:"login-form"},l={class:"form-group"},p=["disabled"],d={class:"form-group"},h={class:"password-input"},g=["type","disabled"],m={class:"form-group"},f={class:"captcha-group"},k={class:"captcha-input"},b=["disabled"],v=["disabled"],y={key:0},L={key:1},w={key:0,class:"error-container"},C={class:"register-link"};function x(e,r,a,s,n,o){var x=(0,t.g2)("router-link");return(0,t.uX)(),(0,t.CE)("div",i,[r[16]||(r[16]=(0,t.Lk)("h2",null,"登录",-1)),(0,t.Lk)("form",{onSubmit:r[8]||(r[8]=(0,c.D$)((function(){return o.handleSubmit&&o.handleSubmit.apply(o,arguments)}),["prevent"]))},[(0,t.Lk)("div",l,[r[9]||(r[9]=(0,t.Lk)("label",{for:"username"},"账号:",-1)),(0,t.bo)((0,t.Lk)("input",{type:"text",id:"username","onUpdate:modelValue":r[0]||(r[0]=function(e){return n.username=e}),required:"",disabled:n.isLoading,onInput:r[1]||(r[1]=function(){return o.clearError&&o.clearError.apply(o,arguments)})},null,40,p),[[c.Jo,n.username]])]),(0,t.Lk)("div",d,[r[10]||(r[10]=(0,t.Lk)("label",{for:"password"},"密码:",-1)),(0,t.Lk)("div",h,[(0,t.bo)((0,t.Lk)("input",{type:n.showPassword?"text":"password",id:"password","onUpdate:modelValue":r[2]||(r[2]=function(e){return n.password=e}),required:"",disabled:n.isLoading,onInput:r[3]||(r[3]=function(){return o.clearError&&o.clearError.apply(o,arguments)})},null,40,g),[[c.hp,n.password]]),(0,t.Lk)("i",{class:(0,u.C4)(["fas",n.showPassword?"fa-eye-slash":"fa-eye"]),onClick:r[4]||(r[4]=function(){return o.togglePassword&&o.togglePassword.apply(o,arguments)})},null,2)])]),(0,t.Lk)("div",m,[r[11]||(r[11]=(0,t.Lk)("label",{for:"captcha"},"验证码:",-1)),(0,t.Lk)("div",f,[(0,t.Lk)("div",k,[(0,t.bo)((0,t.Lk)("input",{type:"text",id:"captcha","onUpdate:modelValue":r[5]||(r[5]=function(e){return n.captchaInput=e}),required:"",disabled:n.isLoading,onInput:r[6]||(r[6]=function(){return o.clearError&&o.clearError.apply(o,arguments)}),placeholder:"请输入验证码",maxlength:"4",pattern:"[0-9]{4}"},null,40,b),[[c.Jo,n.captchaInput]])]),(0,t.Lk)("div",{class:"captcha-code",onClick:r[7]||(r[7]=function(){return o.generateCaptcha&&o.generateCaptcha.apply(o,arguments)}),title:"当前验证码为随机生成"},[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(n.captchaDisplay,(function(e,r){return(0,t.uX)(),(0,t.CE)("span",{key:r,style:(0,u.Tr)(o.getRandomStyle())},(0,u.v_)(e),5)})),128))])])]),(0,t.Lk)("button",{type:"submit",disabled:n.isLoading||!o.isFormValid},[n.isLoading?((0,t.uX)(),(0,t.CE)("span",y,r[12]||(r[12]=[(0,t.Lk)("i",{class:"fas fa-spinner fa-spin"},null,-1),(0,t.eW)(" 登录中... ")]))):((0,t.uX)(),(0,t.CE)("span",L,"登录"))],8,v),n.errorMessage?((0,t.uX)(),(0,t.CE)("div",w,[r[13]||(r[13]=(0,t.Lk)("i",{class:"fas fa-exclamation-circle"},null,-1)),(0,t.eW)(" "+(0,u.v_)(n.errorMessage),1)])):(0,t.Q3)("",!0),(0,t.Lk)("div",C,[r[15]||(r[15]=(0,t.eW)(" 没有账号? ")),(0,t.bF)(x,{to:"/register"},{default:(0,t.k6)((function(){return r[14]||(r[14]=[(0,t.eW)("立即注册")])})),_:1})])],32)])}var I=a(14048),M=a(30388),S=(a(76918),a(28706),a(44114),a(23288),a(26099),a(38781),a(42762),a(76031),a(50788)),E=a.n(S),P=a(32674),F=E().create(P.by);const q={data:function(){return{username:"",password:"",captchaInput:"",captchaDisplay:"",systemCaptcha:"",errorMessage:"",isLoading:!1,showPassword:!1,refreshCount:0}},computed:{isFormValid:function(){return this.username.trim()&&this.password&&this.captchaInput&&4===this.captchaInput.length}},created:function(){if(localStorage.getItem("token")){var e=this.$route.query.redirect||"/";this.$router.push(e)}else this.generateCaptcha()},methods:{clearError:function(){this.errorMessage=""},togglePassword:function(){this.showPassword=!this.showPassword},generateCaptcha:function(){var e=Math.floor(1e3+9e3*Math.random()),r=e.toString();this.captchaDisplay=r,this.systemCaptcha=r,this.captchaInput="";var a=document.querySelector(".captcha-code");a&&this.refreshCount>0&&(a.classList.add("refreshing"),setTimeout((function(){a.classList.remove("refreshing")}),500)),this.refreshCount++,console.log("生成新验证码: ".concat(this.systemCaptcha))},getRandomStyle:function(){var e=Math.floor(10*Math.random())-5,r=14+Math.floor(4*Math.random()),a=Math.floor(3*Math.random())-1;return{transform:"rotate(".concat(e,"deg)"),fontSize:"".concat(r,"px"),letterSpacing:"".concat(a,"px"),display:"inline-block",fontWeight:"bold",margin:"0 2px"}},handleSubmit:function(){var e=this;return(0,M.A)((0,I.A)().mark((function r(){var a,t,s,n,o,c;return(0,I.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(e.isFormValid){r.next=2;break}return r.abrupt("return");case 2:if(e.captchaInput===e.systemCaptcha){r.next=8;break}return console.log('验证码比对失败: 用户输入="'.concat(e.captchaInput,'", 系统验证码="').concat(e.systemCaptcha,'"')),e.errorMessage="验证码错误，请重新输入",e.captchaInput="",e.generateCaptcha(),r.abrupt("return");case 8:return console.log("验证码校验通过，准备提交登录请求"),e.isLoading=!0,e.errorMessage="",r.prev=11,a={username:e.username.trim(),password:e.password,captcha:"0000"},console.log("正在发送登录请求",{用户名:a.username,验证码:"固定发送0000"}),r.prev=14,r.next=17,F.post(P.yl.login,a);case 17:if(t=r.sent,console.log("服务器响应:",t.data),!t.data||!t.data.token){r.next=26;break}return localStorage.setItem("token",t.data.token),localStorage.setItem("username",e.username.trim()),s=e.$route.query.redirect||"/",r.next=25,e.$router.push(s);case 25:return r.abrupt("return");case 26:if(!t.data||!t.data.message){r.next=30;break}return e.errorMessage=t.data.message,e.generateCaptcha(),r.abrupt("return");case 30:r.next=51;break;case 32:if(r.prev=32,r.t0=r["catch"](14),console.error("API调用错误:",r.t0),!r.t0.response){r.next=50;break}n=r.t0.response.status,o=r.t0.response.data,r.t1=n,r.next=401===r.t1?41:403===r.t1?43:500===r.t1?45:47;break;case 41:return e.errorMessage="账号或密码错误",r.abrupt("break",48);case 43:return e.errorMessage="验证码错误",r.abrupt("break",48);case 45:return e.errorMessage="服务器错误，请稍后重试",r.abrupt("break",48);case 47:e.errorMessage=(null===o||void 0===o?void 0:o.message)||"登录失败，请稍后重试";case 48:return e.generateCaptcha(),r.abrupt("return");case 50:console.log("网络错误或服务器未响应，尝试备用登录");case 51:if(console.log("尝试备用登录..."),"test"!==e.username.trim().toLowerCase()||"123456"!==e.password){r.next=60;break}return console.log("备用登录成功"),localStorage.setItem("token","mock-token-12345"),localStorage.setItem("username",e.username.trim()),c=e.$route.query.redirect||"/",r.next=59,e.$router.push(c);case 59:return r.abrupt("return");case 60:e.errorMessage="无法连接到服务器，请检查网络连接",e.generateCaptcha(),r.next=69;break;case 64:r.prev=64,r.t2=r["catch"](11),console.error("登录过程中发生意外错误:",r.t2),e.errorMessage="登录过程中发生错误，请稍后重试",e.generateCaptcha();case 69:return r.prev=69,e.isLoading=!1,r.finish(69);case 72:case"end":return r.stop()}}),r,null,[[11,64,69,72],[14,32]])})))()}}};var X=a(71241);const $=(0,X.A)(q,[["render",x],["__scopeId","data-v-f80bc4b0"]]),_=$,A={components:{LoginForm:_}},V=(0,X.A)(A,[["render",o],["__scopeId","data-v-7040dd90"]]),W=V}}]);
//# sourceMappingURL=511.aaeb3462.js.map